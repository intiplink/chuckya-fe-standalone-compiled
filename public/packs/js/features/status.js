(window.webpackJsonp=window.webpackJsonp||[]).push([[492],{1978:function(t,e,a){"use strict";a.r(e);var s=a(0),i=a(2),o=(a(45),a(180),a(14),a(4)),n=a.n(o),l=a(8),d=a(54),c=a(9),r=a.n(c),h=a(247),u=a(46),p=a(198),g=a(5),b=a(24),m=a.n(b),O=a(37),f=a(10),j=a(190),v=a(1195),k=a(308),_=a(36),M=a(428),y=a(1872),C=a(1270),I=a(141),w=a(227),T=a(39),R=a(399),x=a(25),D=a(285),N=a(90),H=a(63),P=a(327),S=a(1721),U=a(140),B=a(1610),E=a(1724),A=a(1209),V=a(19),F=a(243),q=a(2063),z=a(417),L=a(1),K=a(1673),J=a(1194),W=a(194),G=a(221),Y=a(257),Q=a(386),X=a(300),Z=a(316),$=a(1196),tt=a(1667),et=a(1668),at=a(1197),st=a(238),it=a(75),ot=a(480);const nt=Object(l.d)({delete:{id:"status.delete",defaultMessage:"Delete"},redraft:{id:"status.redraft",defaultMessage:"Delete & re-draft"},edit:{id:"status.edit",defaultMessage:"Edit"},direct:{id:"status.direct",defaultMessage:"Privately mention @{name}"},mention:{id:"status.mention",defaultMessage:"Mention @{name}"},reply:{id:"status.reply",defaultMessage:"Reply"},reblog:{id:"status.reblog",defaultMessage:"Boost"},reblog_private:{id:"status.reblog_private",defaultMessage:"Boost with original visibility"},cancel_reblog_private:{id:"status.cancel_reblog_private",defaultMessage:"Unboost"},cannot_reblog:{id:"status.cannot_reblog",defaultMessage:"This post cannot be boosted"},favourite:{id:"status.favourite",defaultMessage:"Favorite"},bookmark:{id:"status.bookmark",defaultMessage:"Bookmark"},more:{id:"status.more",defaultMessage:"More"},mute:{id:"status.mute",defaultMessage:"Mute @{name}"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"},block:{id:"status.block",defaultMessage:"Block @{name}"},report:{id:"status.report",defaultMessage:"Report @{name}"},share:{id:"status.share",defaultMessage:"Share"},pin:{id:"status.pin",defaultMessage:"Pin on profile"},unpin:{id:"status.unpin",defaultMessage:"Unpin from profile"},embed:{id:"status.embed",defaultMessage:"Embed"},admin_account:{id:"status.admin_account",defaultMessage:"Open moderation interface for @{name}"},admin_status:{id:"status.admin_status",defaultMessage:"Open this post in the moderation interface"},admin_domain:{id:"status.admin_domain",defaultMessage:"Open moderation interface for {domain}"},copy:{id:"status.copy",defaultMessage:"Copy link to post"},blockDomain:{id:"account.block_domain",defaultMessage:"Block domain {domain}"},unblockDomain:{id:"account.unblock_domain",defaultMessage:"Unblock domain {domain}"},unmute:{id:"account.unmute",defaultMessage:"Unmute @{name}"},unblock:{id:"account.unblock",defaultMessage:"Unblock @{name}"},openOriginalPage:{id:"account.open_original_page",defaultMessage:"Open original page"}});class lt extends L.PureComponent{constructor(){super(...arguments),Object(i.a)(this,"handleReplyClick",(()=>{this.props.onReply(this.props.status)})),Object(i.a)(this,"handleReblogClick",(t=>{this.props.onReblog(this.props.status,t)})),Object(i.a)(this,"handleFavouriteClick",(()=>{this.props.onFavourite(this.props.status)})),Object(i.a)(this,"handleBookmarkClick",(t=>{this.props.onBookmark(this.props.status,t)})),Object(i.a)(this,"handleDeleteClick",(()=>{this.props.onDelete(this.props.status,this.props.history)})),Object(i.a)(this,"handleRedraftClick",(()=>{this.props.onDelete(this.props.status,this.props.history,!0)})),Object(i.a)(this,"handleEditClick",(()=>{this.props.onEdit(this.props.status,this.props.history)})),Object(i.a)(this,"handleDirectClick",(()=>{this.props.onDirect(this.props.status.get("account"),this.props.history)})),Object(i.a)(this,"handleMentionClick",(()=>{this.props.onMention(this.props.status.get("account"),this.props.history)})),Object(i.a)(this,"handleMuteClick",(()=>{const{status:t,relationship:e,onMute:a,onUnmute:s}=this.props,i=t.get("account");e&&e.get("muting")?s(i):a(i)})),Object(i.a)(this,"handleBlockClick",(()=>{const{status:t,relationship:e,onBlock:a,onUnblock:s}=this.props,i=t.get("account");e&&e.get("blocking")?s(i):a(t)})),Object(i.a)(this,"handleBlockDomain",(()=>{const{status:t,onBlockDomain:e}=this.props;e(t.get("account"))})),Object(i.a)(this,"handleUnblockDomain",(()=>{const{status:t,onUnblockDomain:e}=this.props;e(t.get("account").get("acct").split("@")[1])})),Object(i.a)(this,"handleConversationMuteClick",(()=>{this.props.onMuteConversation(this.props.status)})),Object(i.a)(this,"handleReport",(()=>{this.props.onReport(this.props.status)})),Object(i.a)(this,"handlePinClick",(()=>{this.props.onPin(this.props.status)})),Object(i.a)(this,"handleShare",(()=>{navigator.share({url:this.props.status.get("url")})})),Object(i.a)(this,"handleEmbed",(()=>{this.props.onEmbed(this.props.status)})),Object(i.a)(this,"handleCopy",(()=>{const t=this.props.status.get("url");navigator.clipboard.writeText(t)}))}render(){const{status:t,relationship:e,intl:a}=this.props,{signedIn:i,permissions:o}=this.props.identity,n=["public","unlisted"].includes(t.get("visibility")),l=["public","unlisted","private"].includes(t.get("visibility")),d=t.get("muted"),c=t.get("account"),h=t.getIn(["account","id"])===V.q,u=t.getIn(["account","username"])!==t.getIn(["account","acct"]);let p,g,b=[];if(n&&u&&b.push({text:a.formatMessage(nt.openOriginalPage),href:t.get("url")}),b.push({text:a.formatMessage(nt.copy),action:this.handleCopy}),n&&"share"in navigator&&b.push({text:a.formatMessage(nt.share),action:this.handleShare}),!n||!i&&u||b.push({text:a.formatMessage(nt.embed),action:this.handleEmbed}),i)if(b.push(null),h)l&&(b.push({text:a.formatMessage(t.get("pinned")?nt.unpin:nt.pin),action:this.handlePinClick}),b.push(null)),b.push({text:a.formatMessage(d?nt.unmuteConversation:nt.muteConversation),action:this.handleConversationMuteClick}),b.push(null),b.push({text:a.formatMessage(nt.edit),action:this.handleEditClick}),b.push({text:a.formatMessage(nt.delete),action:this.handleDeleteClick,dangerous:!0}),b.push({text:a.formatMessage(nt.redraft),action:this.handleRedraftClick,dangerous:!0});else{if(b.push({text:a.formatMessage(nt.mention,{name:t.getIn(["account","username"])}),action:this.handleMentionClick}),b.push(null),e&&e.get("muting")?b.push({text:a.formatMessage(nt.unmute,{name:c.get("username")}),action:this.handleMuteClick}):b.push({text:a.formatMessage(nt.mute,{name:c.get("username")}),action:this.handleMuteClick,dangerous:!0}),e&&e.get("blocking")?b.push({text:a.formatMessage(nt.unblock,{name:c.get("username")}),action:this.handleBlockClick}):b.push({text:a.formatMessage(nt.block,{name:c.get("username")}),action:this.handleBlockClick,dangerous:!0}),b.push({text:a.formatMessage(nt.report,{name:t.getIn(["account","username"])}),action:this.handleReport,dangerous:!0}),c.get("acct")!==c.get("username")){const t=c.get("acct").split("@")[1];b.push(null),e&&e.get("domain_blocking")?b.push({text:a.formatMessage(nt.unblockDomain,{domain:t}),action:this.handleUnblockDomain}):b.push({text:a.formatMessage(nt.blockDomain,{domain:t}),action:this.handleBlockDomain,dangerous:!0})}if(((o&st.d)===st.d||u&&(o&st.b)===st.b)&&(b.push(null),(o&st.d)===st.d&&(b.push({text:a.formatMessage(nt.admin_account,{name:t.getIn(["account","username"])}),href:"/admin/accounts/".concat(t.getIn(["account","id"]))}),b.push({text:a.formatMessage(nt.admin_status),href:"/admin/accounts/".concat(t.getIn(["account","id"]),"/statuses/").concat(t.get("id"))})),u&&(o&st.b)===st.b)){const t=c.get("acct").split("@")[1];b.push({text:a.formatMessage(nt.admin_domain,{domain:t}),href:"/admin/instances/".concat(t)})}}null===t.get("in_reply_to_id",null)?(p="reply",g=Y.a):(p="reply-all",g=Q.a);const m=t.getIn(["account","id"])===V.q&&"private"===t.get("visibility");let O,f;return t.get("reblogged")?(O=a.formatMessage(nt.cancel_reblog_private),f=n?$.a:at.a):n?(O=a.formatMessage(nt.reblog),f=G.a):m?(O=a.formatMessage(nt.reblog_private),f=et.a):(O=a.formatMessage(nt.cannot_reblog),f=tt.a),Object(s.a)("div",{className:"detailed-status__action-bar"},void 0,Object(s.a)("div",{className:"detailed-status__button"},void 0,Object(s.a)(it.a,{title:a.formatMessage(nt.reply),icon:t.get("in_reply_to_account_id")===t.getIn(["account","id"])?"reply":p,iconComponent:t.get("in_reply_to_account_id")===t.getIn(["account","id"])?Y.a:g,onClick:this.handleReplyClick})),Object(s.a)("div",{className:"detailed-status__button"},void 0,Object(s.a)(it.a,{className:r()({reblogPrivate:m}),disabled:!n&&!m,active:t.get("reblogged"),title:O,icon:"retweet",iconComponent:f,onClick:this.handleReblogClick})),Object(s.a)("div",{className:"detailed-status__button"},void 0,Object(s.a)(it.a,{className:"star-icon",animate:!0,active:t.get("favourited"),title:a.formatMessage(nt.favourite),icon:"star",iconComponent:t.get("favourited")?X.a:Z.a,onClick:this.handleFavouriteClick})),Object(s.a)("div",{className:"detailed-status__button"},void 0,Object(s.a)(it.a,{className:"bookmark-icon",disabled:!i,active:t.get("bookmarked"),title:a.formatMessage(nt.bookmark),icon:"bookmark",iconComponent:t.get("bookmarked")?K.a:J.a,onClick:this.handleBookmarkClick})),Object(s.a)("div",{className:"detailed-status__action-bar-dropdown"},void 0,Object(s.a)(ot.a,{icon:"ellipsis-h",iconComponent:W.a,status:t,items:b,direction:"left",title:a.formatMessage(nt.more)})))}}var dt=Object(u.k)(Object(f.connect)(((t,e)=>{let{status:a}=e;return{relationship:t.getIn(["relationships",a.getIn(["account","id"])])}}))(Object(I.e)(Object(d.c)(lt)))),ct=a(26),rt=a(40),ht=a(299),ut=a(1614),pt=a(2105),gt=a(263),bt=a(525),mt=a(1241),Ot=a(1677);var ft=Object(f.connect)(((t,e)=>{let{statusId:a}=e;return{openDropdownId:t.dropdownMenu.openId,openedViaKeyboard:t.dropdownMenu.keyboard,items:t.getIn(["history",a,"items"]),loading:t.getIn(["history",a,"loading"])}}),((t,e)=>{let{statusId:a}=e;return{onOpen(e,s,i){t(Object(mt.d)(a)),t(Object(bt.b)({id:e,keyboard:i}))},onClose(e){t(Object(bt.a)({id:e}))}}}))(Ot.a);class jt extends L.PureComponent{constructor(){super(...arguments),Object(i.a)(this,"handleItemClick",((t,e)=>{const{onItemClick:a}=this.props;a(e)})),Object(i.a)(this,"renderHeader",(t=>Object(s.a)(ct.a,{id:"status.edited_x_times",defaultMessage:"Edited {count, plural, one {# time} other {# times}}",values:{count:t.size-1}}))),Object(i.a)(this,"renderItem",((t,e,a)=>{let{onClick:i,onKeyPress:o}=a;const n=Object(s.a)(gt.a,{timestamp:t.get("created_at"),short:!1}),l=Object(s.a)(pt.a,{accountId:t.get("account")}),d=t.get("original")?Object(s.a)(ct.a,{id:"status.history.created",defaultMessage:"{name} created {date}",values:{name:l,date:n}}):Object(s.a)(ct.a,{id:"status.history.edited",defaultMessage:"{name} edited {date}",values:{name:l,date:n}});return Object(s.a)("li",{className:"dropdown-menu__item edited-timestamp__history__item"},t.get("created_at"),Object(s.a)("button",{"data-index":e,onClick:i,onKeyPress:o},void 0,d))}))}render(){const{timestamp:t,intl:e,statusId:a}=this.props;return Object(s.a)(ft,{statusId:a,renderItem:this.renderItem,scrollable:!0,renderHeader:this.renderHeader,onItemClick:this.handleItemClick},void 0,Object(s.a)("button",{className:"dropdown-menu__text-button"},void 0,Object(s.a)(ct.a,{id:"status.edited",defaultMessage:"Edited {date}",values:{date:Object(s.a)("span",{className:"animated-number"},void 0,e.formatDate(t,{month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}))}})))}}var vt=Object(f.connect)(null,((t,e)=>{let{statusId:a}=e;return{onItemClick(e){t(Object(H.b)({modalType:"COMPARE_HISTORY",modalProps:{index:e,statusId:a}}))}}}))(Object(d.c)(jt)),kt=a(1683),_t=a(1680),Mt=a(1227),yt=a(193),Ct=a(232),It=a(1873),wt=a(522),Tt=a(518),Rt=a(1860),xt=a(258),Dt=a(1674),Nt=a(6);class Ht extends O.a{constructor(){super(...arguments),Object(i.a)(this,"state",{height:null}),Object(i.a)(this,"handleAccountClick",(t=>{0!==t.button||t.ctrlKey||t.metaKey||!this.props.history||(t.preventDefault(),this.props.history.push("/@".concat(this.props.status.getIn(["account","acct"])))),t.stopPropagation()})),Object(i.a)(this,"handleOpenVideo",(t=>{this.props.onOpenVideo(this.props.status.getIn(["media_attachments",0]),t)})),Object(i.a)(this,"handleExpandedToggle",(()=>{this.props.onToggleHidden(this.props.status)})),Object(i.a)(this,"setRef",(t=>{this.node=t,this._measureHeight()})),Object(i.a)(this,"handleModalLink",(t=>{let e;t.preventDefault(),e="A"!==t.target.nodeName?t.target.parentNode.href:t.target.href,window.open(e,"mastodon-intent","width=445,height=600,resizable=no,menubar=no,status=no,scrollbars=yes")})),Object(i.a)(this,"handleTranslate",(()=>{const{onTranslate:t,status:e}=this.props;t(e)}))}_measureHeight(t){this.props.measureHeight&&this.node&&(Object(Rt.a)((()=>this.node&&this.setState({height:Math.ceil(this.node.scrollHeight)+1}))),this.props.onHeightChange&&t&&this.props.onHeightChange())}componentDidUpdate(t,e){this._measureHeight(e.height!==this.state.height)}_properStatus(){const{status:t}=this.props;return null!==t.get("reblog",null)&&"object"==typeof t.get("reblog")?t.get("reblog"):t}getAttachmentAspectRatio(){const t=this._properStatus().get("media_attachments");return"video"===t.getIn([0,"type"])?"".concat(t.getIn([0,"meta","original","width"])," / ").concat(t.getIn([0,"meta","original","height"])):"audio"===t.getIn([0,"type"])?"16 / 9":1===t.size&&t.getIn([0,"meta","small","aspect"])?t.getIn([0,"meta","small","aspect"]):"3 / 2"}render(){const t=this._properStatus(),e={boxSizing:"border-box"},{compact:a,pictureInPicture:i}=this.props;if(!t)return null;let o="",n="",d="",c="";this.props.measureHeight&&(e.height="".concat(this.state.height,"px"));const h=t.getIn(["translation","language"])||t.get("language");if(i.get("inUse"))o=Object(s.a)(_t.a,{aspectRatio:this.getAttachmentAspectRatio()});else if(t.get("media_attachments").size>0)if("audio"===t.getIn(["media_attachments",0,"type"])){const e=t.getIn(["media_attachments",0]),a=e.getIn(["translation","description"])||e.get("description");o=Object(s.a)(Tt.default,{src:e.get("url"),alt:a,lang:h,duration:e.getIn(["meta","original","duration"],0),poster:e.get("preview_url")||t.getIn(["account","avatar_static"]),backgroundColor:e.getIn(["meta","colors","background"]),foregroundColor:e.getIn(["meta","colors","foreground"]),accentColor:e.getIn(["meta","colors","accent"]),sensitive:t.get("sensitive"),visible:this.props.showMedia,blurhash:e.get("blurhash"),height:150,onToggleVisibility:this.props.onToggleMediaVisibility})}else if("video"===t.getIn(["media_attachments",0,"type"])){const e=t.getIn(["media_attachments",0]),a=e.getIn(["translation","description"])||e.get("description");o=Object(s.a)(xt.default,{preview:e.get("preview_url"),frameRate:e.getIn(["meta","original","frame_rate"]),aspectRatio:"".concat(e.getIn(["meta","original","width"])," / ").concat(e.getIn(["meta","original","height"])),blurhash:e.get("blurhash"),src:e.get("url"),alt:a,lang:h,width:300,height:150,onOpenVideo:this.handleOpenVideo,sensitive:t.get("sensitive"),visible:this.props.showMedia,onToggleVisibility:this.props.onToggleMediaVisibility})}else o=Object(s.a)(It.default,{standalone:!0,sensitive:t.get("sensitive"),media:t.get("media_attachments"),lang:h,height:300,onOpenMedia:this.props.onOpenMedia,visible:this.props.showMedia,onToggleVisibility:this.props.onToggleMediaVisibility});else 0===t.get("spoiler_text").length&&(o=Object(s.a)(Dt.a,{sensitive:t.get("sensitive"),onOpenMedia:this.props.onOpenMedia,card:t.get("card",null)}));t.get("application")&&(n=Object(Nt.jsxs)(Nt.Fragment,{children:["·",Object(s.a)("a",{className:"detailed-status__application",href:t.getIn(["application","website"]),target:"_blank",rel:"noopener noreferrer"},void 0,t.getIn(["application","name"]))]}));const u=Object(Nt.jsxs)(Nt.Fragment,{children:["·",Object(s.a)(Mt.a,{visibility:t.get("visibility")})]});d=["private","direct"].includes(t.get("visibility"))?"":this.props.history?Object(s.a)(rt.a,{to:"/@".concat(t.getIn(["account","acct"]),"/").concat(t.get("id"),"/reblogs"),className:"detailed-status__link"},void 0,Object(s.a)("span",{className:"detailed-status__reblogs"},void 0,Object(s.a)(ut.a,{value:t.get("reblogs_count")})),Object(s.a)(ct.a,{id:"status.reblogs",defaultMessage:"{count, plural, one {boost} other {boosts}}",values:{count:t.get("reblogs_count")}})):Object(s.a)("a",{href:"/interact/".concat(t.get("id"),"?type=reblog"),className:"detailed-status__link",onClick:this.handleModalLink},void 0,Object(s.a)("span",{className:"detailed-status__reblogs"},void 0,Object(s.a)(ut.a,{value:t.get("reblogs_count")})),Object(s.a)(ct.a,{id:"status.reblogs",defaultMessage:"{count, plural, one {boost} other {boosts}}",values:{count:t.get("reblogs_count")}})),c=this.props.history?Object(s.a)(rt.a,{to:"/@".concat(t.getIn(["account","acct"]),"/").concat(t.get("id"),"/favourites"),className:"detailed-status__link"},void 0,Object(s.a)("span",{className:"detailed-status__favorites"},void 0,Object(s.a)(ut.a,{value:t.get("favourites_count")})),Object(s.a)(ct.a,{id:"status.favourites",defaultMessage:"{count, plural, one {favorite} other {favorites}}",values:{count:t.get("favourites_count")}})):Object(s.a)("a",{href:"/interact/".concat(t.get("id"),"?type=favourite"),className:"detailed-status__link",onClick:this.handleModalLink},void 0,Object(s.a)("span",{className:"detailed-status__favorites"},void 0,Object(s.a)(ut.a,{value:t.get("favourites_count")})),Object(s.a)(ct.a,{id:"status.favourites",defaultMessage:"{count, plural, one {favorite} other {favorites}}",values:{count:t.get("favourites_count")}}));const{statusContentProps:p,hashtagBar:g}=Object(kt.a)(t),b=!t.get("hidden")||0===t.get("spoiler_text").length;return Object(s.a)("div",{style:e},void 0,Object(Nt.jsxs)("div",{ref:this.setRef,className:r()("detailed-status",{compact:a}),children:["direct"===t.get("visibility")&&Object(s.a)("div",{className:"status__prepend"},void 0,Object(s.a)("div",{className:"status__prepend-icon-wrapper"},void 0,Object(s.a)(_.a,{id:"at",icon:ht.a,className:"status__prepend-icon"})),Object(s.a)(ct.a,{id:"status.direct_indicator",defaultMessage:"Private mention"})),Object(s.a)("a",{href:"/@".concat(t.getIn(["account","acct"])),"data-hover-card-account":t.getIn(["account","id"]),onClick:this.handleAccountClick,className:"detailed-status__display-name"},void 0,Object(s.a)("div",{className:"detailed-status__display-avatar"},void 0,Object(s.a)(yt.a,{account:t.get("account"),size:46})),Object(s.a)(Ct.a,{account:t.get("account"),localDomain:this.props.domain})),Object(Nt.jsx)(wt.a,{status:t,expanded:!t.get("hidden"),onExpandedToggle:this.handleExpandedToggle,onTranslate:this.handleTranslate,...p}),o,b&&g,Object(s.a)("div",{className:"detailed-status__meta"},void 0,Object(s.a)("div",{className:"detailed-status__meta__line"},void 0,Object(s.a)("a",{className:"detailed-status__datetime",href:"/@".concat(t.getIn(["account","acct"]),"/").concat(t.get("id")),target:"_blank",rel:"noopener noreferrer"},void 0,Object(s.a)(l.a,{value:new Date(t.get("created_at")),year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})),u,n),t.get("edited_at")&&Object(s.a)("div",{className:"detailed-status__meta__line"},void 0,Object(s.a)(vt,{statusId:t.get("id"),timestamp:t.get("edited_at")})),Object(s.a)("div",{className:"detailed-status__meta__line"},void 0,d,d&&Object(Nt.jsx)(Nt.Fragment,{children:"·"}),c))]}))}}Object(i.a)(Ht,"propTypes",{status:m.a.map,onOpenMedia:n.a.func.isRequired,onOpenVideo:n.a.func.isRequired,onToggleHidden:n.a.func.isRequired,onTranslate:n.a.func.isRequired,measureHeight:n.a.bool,onHeightChange:n.a.func,domain:n.a.string.isRequired,compact:n.a.bool,showMedia:n.a.bool,pictureInPicture:m.a.contains({inUse:n.a.bool,available:n.a.bool}),onToggleMediaVisibility:n.a.func,...w.b});var Pt=Object(u.k)(Ht);const St=Object(l.d)({deleteConfirm:{id:"confirmations.delete.confirm",defaultMessage:"Delete"},deleteMessage:{id:"confirmations.delete.message",defaultMessage:"Are you sure you want to delete this status?"},redraftConfirm:{id:"confirmations.redraft.confirm",defaultMessage:"Delete & redraft"},redraftMessage:{id:"confirmations.redraft.message",defaultMessage:"Are you sure you want to delete this status and re-draft it? Favorites and boosts will be lost, and replies to the original post will be orphaned."},revealAll:{id:"status.show_more_all",defaultMessage:"Show more for all"},hideAll:{id:"status.show_less_all",defaultMessage:"Show less for all"},statusTitleWithAttachments:{id:"status.title.with_attachments",defaultMessage:"{user} posted {attachmentCount, plural, one {an attachment} other {# attachments}}"},detailedStatus:{id:"status.detailed_status",defaultMessage:"Detailed conversation view"},replyConfirm:{id:"confirmations.reply.confirm",defaultMessage:"Reply"},replyMessage:{id:"confirmations.reply.message",defaultMessage:"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?"},blockDomainConfirm:{id:"confirmations.domain_block.confirm",defaultMessage:"Block entire domain"}}),Ut=(t,e)=>{const a=e.getIn(["account","display_name"]),s=e.getIn(["account","username"]),i=0===a.trim().length?s:a,o=e.get("search_index"),n=e.get("media_attachments").size;return o?"".concat(i,': "').concat(((t,e)=>{const a=Array.from(t);return a.length>e?a.slice(0,e).join("")+"…":t})(o,30),'"'):t.formatMessage(St.statusTitleWithAttachments,{user:i,attachmentCount:n})};class Bt extends O.a{constructor(){var t;super(...arguments),t=this,Object(i.a)(this,"state",{fullscreen:!1,showMedia:Object(E.b)(this.props.status),loadedStatusId:void 0}),Object(i.a)(this,"handleToggleMediaVisibility",(()=>{this.setState({showMedia:!this.state.showMedia})})),Object(i.a)(this,"handleFavouriteClick",(t=>{const{dispatch:e}=this.props,{signedIn:a}=this.props.identity;a?t.get("favourited")?e(Object(N.J)(t)):e(Object(N.D)(t)):e(Object(H.b)({modalType:"INTERACTION",modalProps:{type:"favourite",accountId:t.getIn(["account","id"]),url:t.get("uri")}}))})),Object(i.a)(this,"handlePin",(t=>{t.get("pinned")?this.props.dispatch(Object(N.K)(t)):this.props.dispatch(Object(N.G)(t))})),Object(i.a)(this,"handleReplyClick",(t=>{const{askReplyConfirmation:e,dispatch:a,intl:s}=this.props,{signedIn:i}=this.props.identity;a(i?e?Object(H.b)({modalType:"CONFIRM",modalProps:{message:s.formatMessage(St.replyMessage),confirm:s.formatMessage(St.replyConfirm),onConfirm:()=>a(Object(x.ub)(t,this.props.history))}}):Object(x.ub)(t,this.props.history):Object(H.b)({modalType:"INTERACTION",modalProps:{type:"reply",accountId:t.getIn(["account","id"]),url:t.get("uri")}}))})),Object(i.a)(this,"handleModalReblog",((t,e)=>{this.props.dispatch(Object(N.H)({statusId:t.get("id"),visibility:e}))})),Object(i.a)(this,"handleReblogClick",((t,e)=>{const{dispatch:a}=this.props,{signedIn:s}=this.props.identity;s?t.get("reblogged")?a(Object(N.L)({statusId:t.get("id")})):e&&e.shiftKey||!V.b?this.handleModalReblog(t):a(Object(H.b)({modalType:"BOOST",modalProps:{status:t,onReblog:this.handleModalReblog}})):a(Object(H.b)({modalType:"INTERACTION",modalProps:{type:"reblog",accountId:t.getIn(["account","id"]),url:t.get("uri")}}))})),Object(i.a)(this,"handleBookmarkClick",(t=>{t.get("bookmarked")?this.props.dispatch(Object(N.I)(t)):this.props.dispatch(Object(N.A)(t))})),Object(i.a)(this,"handleDeleteClick",(function(e,a){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{dispatch:i,intl:o}=t.props;V.e?i(Object(H.b)({modalType:"CONFIRM",modalProps:{message:o.formatMessage(s?St.redraftMessage:St.deleteMessage),confirm:o.formatMessage(s?St.redraftConfirm:St.deleteConfirm),onConfirm:()=>i(Object(U.l)(e.get("id"),a,s))}})):i(Object(U.l)(e.get("id"),a,s))})),Object(i.a)(this,"handleEditClick",((t,e)=>{this.props.dispatch(Object(U.m)(t.get("id"),e))})),Object(i.a)(this,"handleDirectClick",((t,e)=>{this.props.dispatch(Object(x.ib)(t,e))})),Object(i.a)(this,"handleMentionClick",((t,e)=>{this.props.dispatch(Object(x.pb)(t,e))})),Object(i.a)(this,"handleOpenMedia",((t,e,a)=>{this.props.dispatch(Object(H.b)({modalType:"MEDIA",modalProps:{statusId:this.props.status.get("id"),media:t,index:e,lang:a}}))})),Object(i.a)(this,"handleOpenVideo",((t,e,a)=>{this.props.dispatch(Object(H.b)({modalType:"VIDEO",modalProps:{statusId:this.props.status.get("id"),media:t,lang:e,options:a}}))})),Object(i.a)(this,"handleHotkeyOpenMedia",(t=>{const{status:e}=this.props;t.preventDefault(),e.get("media_attachments").size>0&&("video"===e.getIn(["media_attachments",0,"type"])?this.handleOpenVideo(e.getIn(["media_attachments",0]),{startTime:0}):this.handleOpenMedia(e.get("media_attachments"),0))})),Object(i.a)(this,"handleMuteClick",(t=>{this.props.dispatch(Object(P.i)(t))})),Object(i.a)(this,"handleConversationMuteClick",(t=>{t.get("muted")?this.props.dispatch(Object(U.u)(t.get("id"))):this.props.dispatch(Object(U.p)(t.get("id")))})),Object(i.a)(this,"handleToggleHidden",(t=>{t.get("hidden")?this.props.dispatch(Object(U.q)(t.get("id"))):this.props.dispatch(Object(U.o)(t.get("id")))})),Object(i.a)(this,"handleToggleAll",(()=>{const{status:t,ancestorsIds:e,descendantsIds:a}=this.props,s=[t.get("id")].concat(e.toJS(),a.toJS());t.get("hidden")?this.props.dispatch(Object(U.q)(s)):this.props.dispatch(Object(U.o)(s))})),Object(i.a)(this,"handleTranslate",(t=>{const{dispatch:e}=this.props;t.get("translation")?e(Object(U.t)(t.get("id"),t.get("poll"))):e(Object(U.s)(t.get("id")))})),Object(i.a)(this,"handleBlockClick",(t=>{const{dispatch:e}=this.props,a=t.get("account");e(Object(R.i)(a))})),Object(i.a)(this,"handleReport",(t=>{this.props.dispatch(Object(S.a)(t.get("account"),t))})),Object(i.a)(this,"handleEmbed",(t=>{this.props.dispatch(Object(H.b)({modalType:"EMBED",modalProps:{id:t.get("id")}}))})),Object(i.a)(this,"handleUnmuteClick",(t=>{this.props.dispatch(Object(T.P)(t.get("id")))})),Object(i.a)(this,"handleUnblockClick",(t=>{this.props.dispatch(Object(T.M)(t.get("id")))})),Object(i.a)(this,"handleBlockDomainClick",(t=>{this.props.dispatch(Object(D.g)(t))})),Object(i.a)(this,"handleUnblockDomainClick",(t=>{this.props.dispatch(Object(D.h)(t))})),Object(i.a)(this,"handleHotkeyMoveUp",(()=>{this.handleMoveUp(this.props.status.get("id"))})),Object(i.a)(this,"handleHotkeyMoveDown",(()=>{this.handleMoveDown(this.props.status.get("id"))})),Object(i.a)(this,"handleHotkeyReply",(t=>{t.preventDefault(),this.handleReplyClick(this.props.status)})),Object(i.a)(this,"handleHotkeyFavourite",(()=>{this.handleFavouriteClick(this.props.status)})),Object(i.a)(this,"handleHotkeyBoost",(()=>{this.handleReblogClick(this.props.status)})),Object(i.a)(this,"handleHotkeyMention",(t=>{t.preventDefault(),this.handleMentionClick(this.props.status.get("account"))})),Object(i.a)(this,"handleHotkeyOpenProfile",(()=>{this.props.history.push("/@".concat(this.props.status.getIn(["account","acct"])))})),Object(i.a)(this,"handleHotkeyToggleHidden",(()=>{this.handleToggleHidden(this.props.status)})),Object(i.a)(this,"handleHotkeyToggleSensitive",(()=>{this.handleToggleMediaVisibility()})),Object(i.a)(this,"handleMoveUp",(t=>{const{status:e,ancestorsIds:a,descendantsIds:s}=this.props;if(t===e.get("id"))this._selectChild(a.size-1,!0);else{let e=a.indexOf(t);-1===e?(e=s.indexOf(t),this._selectChild(a.size+e,!0)):this._selectChild(e-1,!0)}})),Object(i.a)(this,"handleMoveDown",(t=>{const{status:e,ancestorsIds:a,descendantsIds:s}=this.props;if(t===e.get("id"))this._selectChild(a.size+1,!1);else{let e=a.indexOf(t);-1===e?(e=s.indexOf(t),this._selectChild(a.size+e+2,!1)):this._selectChild(e+1,!1)}})),Object(i.a)(this,"setContainerRef",(t=>{this.node=t})),Object(i.a)(this,"setStatusRef",(t=>{this.statusNode=t})),Object(i.a)(this,"onFullScreenChange",(()=>{this.setState({fullscreen:Object(z.d)()})})),Object(i.a)(this,"shouldUpdateScroll",((t,e)=>{var a,s;let{location:i}=e;return(null===(a=i.state)||void 0===a?void 0:a.mastodonModalKey)===(null==t||null===(s=t.location)||void 0===s||null===(s=s.state)||void 0===s?void 0:s.mastodonModalKey)&&(!!this.statusNode&&[0,this.statusNode.offsetTop])}))}UNSAFE_componentWillMount(){this.props.dispatch(Object(U.n)(this.props.params.statusId))}componentDidMount(){Object(z.a)(this.onFullScreenChange),this._scrollStatusIntoView()}UNSAFE_componentWillReceiveProps(t){t.params.statusId!==this.props.params.statusId&&t.params.statusId&&this.props.dispatch(Object(U.n)(t.params.statusId)),t.status&&t.status.get("id")!==this.state.loadedStatusId&&this.setState({showMedia:Object(E.b)(t.status),loadedStatusId:t.status.get("id")})}_selectChild(t,e){const a=this.node,s=a.querySelectorAll(".focusable")[t];s&&(e&&a.scrollTop>s.offsetTop?s.scrollIntoView(!0):!e&&a.scrollTop+a.clientHeight<s.offsetTop+s.offsetHeight&&s.scrollIntoView(!1),s.focus())}renderChildren(t,e){const{params:{statusId:a}}=this.props;return t.map(((i,o)=>Object(s.a)(A.a,{id:i,onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,contextType:"thread",previousId:o>0?t.get(o-1):void 0,nextId:t.get(o+1)||e&&a,rootId:a},i)))}_scrollStatusIntoView(){const{status:t,multiColumn:e}=this.props;t&&requestIdleCallback((()=>{var t;if(null===(t=this.statusNode)||void 0===t||t.scrollIntoView(!0),!e){var a;const t=null===(a=document.querySelector(".column-header__wrapper"))||void 0===a||null===(a=a.getBoundingClientRect())||void 0===a?void 0:a.bottom;if(t){(document.scrollingElement||document.body).scrollBy(0,-t)}}}))}componentDidUpdate(t){var e;const{status:a,ancestorsIds:s}=this.props;a&&(s.size>t.ancestorsIds.size||(null===(e=t.status)||void 0===e?void 0:e.get("id"))!==a.get("id"))&&this._scrollStatusIntoView()}componentWillUnmount(){Object(z.b)(this.onFullScreenChange)}render(){let t,e;const{isLoading:a,status:i,ancestorsIds:o,descendantsIds:n,intl:l,domain:d,multiColumn:c,pictureInPicture:u}=this.props,{fullscreen:p}=this.state;if(a)return Object(s.a)(q.a,{},void 0,Object(s.a)(M.a,{}));if(null===i)return Object(s.a)(C.a,{multiColumn:c,errorType:"routing"});o&&o.size>0&&(t=Object(Nt.jsx)(Nt.Fragment,{children:this.renderChildren(o,!0)})),n&&n.size>0&&(e=Object(Nt.jsx)(Nt.Fragment,{children:this.renderChildren(n)}));const g=-1===i.getIn(["account","acct"],"").indexOf("@"),b=!i.getIn(["account","noindex"]),m={moveUp:this.handleHotkeyMoveUp,moveDown:this.handleHotkeyMoveDown,reply:this.handleHotkeyReply,favourite:this.handleHotkeyFavourite,boost:this.handleHotkeyBoost,mention:this.handleHotkeyMention,openProfile:this.handleHotkeyOpenProfile,toggleHidden:this.handleHotkeyToggleHidden,toggleSensitive:this.handleHotkeyToggleSensitive,openMedia:this.handleHotkeyOpenMedia};return Object(s.a)(q.a,{bindToDocument:!c,label:l.formatMessage(St.detailedStatus)},void 0,Object(s.a)(B.b,{showBackButton:!0,multiColumn:c,extraButton:Object(s.a)("button",{type:"button",className:"column-header__button",title:l.formatMessage(i.get("hidden")?St.revealAll:St.hideAll),"aria-label":l.formatMessage(i.get("hidden")?St.revealAll:St.hideAll),onClick:this.handleToggleAll},void 0,Object(s.a)(_.a,{id:i.get("hidden")?"eye-slash":"eye",icon:i.get("hidden")?k.a:v.a}))}),Object(s.a)(y.a,{scrollKey:"thread",shouldUpdateScroll:this.shouldUpdateScroll},void 0,Object(Nt.jsxs)("div",{className:r()("scrollable",{fullscreen:p}),ref:this.setContainerRef,children:[t,Object(s.a)(j.HotKeys,{handlers:m},void 0,Object(Nt.jsxs)("div",{className:r()("focusable","detailed-status__wrapper","detailed-status__wrapper-".concat(i.get("visibility"))),tabIndex:0,"aria-label":Object(E.c)(l,i,!1),ref:this.setStatusRef,children:[Object(s.a)(Pt,{status:i,onOpenVideo:this.handleOpenVideo,onOpenMedia:this.handleOpenMedia,onToggleHidden:this.handleToggleHidden,onTranslate:this.handleTranslate,domain:d,showMedia:this.state.showMedia,onToggleMediaVisibility:this.handleToggleMediaVisibility,pictureInPicture:u},"details-".concat(i.get("id"))),Object(s.a)(dt,{status:i,onReply:this.handleReplyClick,onFavourite:this.handleFavouriteClick,onReblog:this.handleReblogClick,onBookmark:this.handleBookmarkClick,onDelete:this.handleDeleteClick,onEdit:this.handleEditClick,onDirect:this.handleDirectClick,onMention:this.handleMentionClick,onMute:this.handleMuteClick,onUnmute:this.handleUnmuteClick,onMuteConversation:this.handleConversationMuteClick,onBlock:this.handleBlockClick,onUnblock:this.handleUnblockClick,onBlockDomain:this.handleBlockDomainClick,onUnblockDomain:this.handleUnblockDomainClick,onReport:this.handleReport,onPin:this.handlePin,onEmbed:this.handleEmbed},"action-bar-".concat(i.get("id")))]})),e]})),Object(s.a)(h.a,{},void 0,Object(s.a)("title",{},void 0,Ut(l,i)),Object(s.a)("meta",{name:"robots",content:g&&b?"all":"noindex"}),Object(s.a)("link",{rel:"canonical",href:i.get("url")})))}}Object(i.a)(Bt,"propTypes",{identity:I.c,params:n.a.object.isRequired,dispatch:n.a.func.isRequired,status:m.a.map,isLoading:n.a.bool,ancestorsIds:m.a.list.isRequired,descendantsIds:m.a.list.isRequired,intl:n.a.object.isRequired,askReplyConfirmation:n.a.bool,multiColumn:n.a.bool,domain:n.a.string.isRequired,pictureInPicture:m.a.contains({inUse:n.a.bool,available:n.a.bool}),...w.b});e.default=Object(u.k)(Object(d.c)(Object(f.connect)((()=>{const t=Object(F.i)(),e=Object(F.g)(),a=Object(p.a)([(t,e)=>{let{id:a}=e;return a},t=>t.getIn(["contexts","inReplyTos"])],((t,e)=>{let a=g.default.List();return a=a.withMutations((a=>{let s=t;for(;s&&!a.includes(s);)a.unshift(s),s=e.get(s)})),a})),s=Object(p.a)([(t,e)=>{let{id:a}=e;return a},t=>t.getIn(["contexts","replies"]),t=>t.get("statuses")],((t,e,a)=>{let s=[];const i=[t];for(;i.length>0;){let a=i.pop();const o=e.get(a);t!==a&&s.push(a),o&&o.reverse().forEach((e=>{i.includes(e)||s.includes(e)||t===e||i.push(e)}))}let o=s.findIndex((t=>a.get(t).get("in_reply_to_account_id")!==a.get(t).get("account")));return-1!==o&&s.forEach(((t,e)=>{e>o&&a.get(t).get("in_reply_to_account_id")===a.get(t).get("account")&&(s.splice(e,1),s.splice(o,0,t),o+=1)})),g.default.List(s)}));return(i,o)=>{const n=t(i,{id:o.params.statusId});let l=g.default.List(),d=g.default.List();return n&&(l=a(i,{id:n.get("in_reply_to_id")}),d=s(i,{id:n.get("id")})),{isLoading:i.getIn(["statuses",o.params.statusId,"isLoading"]),status:n,ancestorsIds:l,descendantsIds:d,askReplyConfirmation:0!==i.getIn(["compose","text"]).trim().length,domain:i.getIn(["meta","domain"]),pictureInPicture:e(i,{id:o.params.statusId})}}}))(Object(I.e)(Bt))))}}]);
//# sourceMappingURL=status.js.map