(window.webpackJsonp=window.webpackJsonp||[]).push([[475],{1981:function(t,e,a){"use strict";a.r(e);var s=a(0),n=a(2),o=a(2101),i=a.n(o),c=(a(45),a(14),a(1)),l=a(26),d=a(247),h=a(10),r=a(2064),g=a(536),u=a(1738),p=a(290),m=a(86),b=a(1290),O=a(1610),j=a(141),_=a(2067),v=a(8),f=a(54),y=a(134),M=a(264);const w=Object(v.d)({followHashtag:{id:"hashtag.follow",defaultMessage:"Follow hashtag"},unfollowHashtag:{id:"hashtag.unfollow",defaultMessage:"Unfollow hashtag"}}),C=(t,e)=>Object(s.a)(l.a,{id:"hashtag.counter_by_uses",defaultMessage:"{count, plural, one {{counter} post} other {{counter} posts}}",values:{count:e,counter:Object(s.a)("strong",{},void 0,t)}}),I=(t,e)=>Object(s.a)(l.a,{id:"hashtag.counter_by_accounts",defaultMessage:"{count, plural, one {{counter} participant} other {{counter} participants}}",values:{count:e,counter:Object(s.a)("strong",{},void 0,t)}}),N=(t,e)=>Object(s.a)(l.a,{id:"hashtag.counter_by_uses_today",defaultMessage:"{count, plural, one {{counter} post} other {{counter} posts}} today",values:{count:e,counter:Object(s.a)("strong",{},void 0,t)}}),S=Object(f.c)((t=>{let{tag:e,intl:a,disabled:n,onClick:o}=t;if(!e)return null;const[i,c]=e.get("history").reduce(((t,e)=>[t[0]+1*e.get("uses"),t[1]+1*e.get("accounts")]),[0,0]),l=Object(s.a)("span",{"aria-hidden":!0},void 0," · ");return Object(s.a)("div",{className:"hashtag-header"},void 0,Object(s.a)("div",{className:"hashtag-header__header"},void 0,Object(s.a)("h1",{},void 0,"#",e.get("name")),Object(s.a)(y.a,{onClick:o,text:a.formatMessage(e.get("following")?w.unfollowHashtag:w.followHashtag),disabled:n})),Object(s.a)("div",{},void 0,Object(s.a)(M.a,{value:i,renderer:C}),l,Object(s.a)(M.a,{value:c,renderer:I}),l,Object(s.a)(M.a,{value:1*e.getIn(["history",0,"uses"]),renderer:N})))}));var k=a(15),F=a(2102),T=a(2126),x=a(1718),H=a.n(x),L=a(2072);const P=Object(v.d)({placeholder:{id:"hashtag.column_settings.select.placeholder",defaultMessage:"Enter hashtags…"},noOptions:{id:"hashtag.column_settings.select.no_options_message",defaultMessage:"No suggestions found"}});class U extends c.PureComponent{constructor(){super(...arguments),Object(n.a)(this,"state",{open:this.hasTags()}),Object(n.a)(this,"onSelect",(t=>e=>{const a=this.tags(t);e.length>4&&!(e<a)||this.props.onChange(["tags",t],e)})),Object(n.a)(this,"onToggle",(()=>{this.state.open&&this.hasTags()&&this.props.onChange("tags",{}),this.setState({open:!this.state.open})})),Object(n.a)(this,"noOptionsMessage",(()=>this.props.intl.formatMessage(P.noOptions)))}hasTags(){return["all","any","none"].map((t=>this.tags(t).length>0)).includes(!0)}tags(t){let e=this.props.settings.getIn(["tags",t])||[];return e.toJS?e.toJS():e}modeSelect(t){return Object(s.a)("div",{className:"column-settings__row"},void 0,Object(s.a)("span",{className:"column-settings__section"},void 0,this.modeLabel(t)),Object(s.a)(F.a,{nonce:document.querySelector("meta[name=style-nonce]").content,cacheKey:"tags"},void 0,Object(s.a)(T.a,{isMulti:!0,autoFocus:!0,value:this.tags(t),onChange:this.onSelect(t),loadOptions:this.props.onLoad,className:"column-select__container",classNamePrefix:"column-select",name:"tags",placeholder:this.props.intl.formatMessage(P.placeholder),noOptionsMessage:this.noOptionsMessage})))}modeLabel(t){switch(t){case"any":return Object(s.a)(l.a,{id:"hashtag.column_settings.tag_mode.any",defaultMessage:"Any of these"});case"all":return Object(s.a)(l.a,{id:"hashtag.column_settings.tag_mode.all",defaultMessage:"All of these"});case"none":return Object(s.a)(l.a,{id:"hashtag.column_settings.tag_mode.none",defaultMessage:"None of these"});default:return""}}render(){const{settings:t,onChange:e}=this.props;return Object(s.a)("div",{className:"column-settings"},void 0,Object(s.a)("section",{},void 0,Object(s.a)("div",{className:"column-settings__row"},void 0,Object(s.a)(L.a,{settings:t,settingPath:["local"],onChange:e,label:Object(s.a)(l.a,{id:"community.column_settings.local_only",defaultMessage:"Local only"})}),Object(s.a)("div",{className:"setting-toggle"},void 0,Object(s.a)(H.a,{id:"hashtag.column_settings.tag_toggle",onChange:this.onToggle,checked:this.state.open}),Object(s.a)("span",{className:"setting-toggle__label"},void 0,Object(s.a)(l.a,{id:"hashtag.column_settings.tag_toggle",defaultMessage:"Include additional tags in this column"})))),this.state.open&&Object(s.a)("div",{className:"column-settings__hashtags"},void 0,this.modeSelect("any"),this.modeSelect("all"),this.modeSelect("none"))))}}var A=Object(f.c)(U);var D=Object(h.connect)(((t,e)=>{let{columnId:a}=e;const s=t.getIn(["settings","columns"]),n=s.findIndex((t=>t.get("uuid")===a));return a&&n>=0?{settings:s.get(n).get("params"),onLoad:t=>Object(k.d)().get("/api/v2/search",{params:{q:t,type:"hashtags"}}).then((t=>(t.data.hashtags||[]).map((t=>({value:t.name,label:"#".concat(t.name)})))))}:{}}),((t,e)=>{let{columnId:a}=e;return{onChange(e,s){t(Object(g.f)(a,e,s))}}}))(A),J=a(6);class q extends c.PureComponent{constructor(){super(...arguments),Object(n.a)(this,"disconnects",[]),Object(n.a)(this,"handlePin",(()=>{const{columnId:t,dispatch:e}=this.props;e(t?Object(g.h)(t):Object(g.e)("HASHTAG",{id:this.props.params.id}))})),Object(n.a)(this,"title",(()=>{const{id:t}=this.props.params,e=[t];return this.additionalFor("any")&&e.push(" ",Object(s.a)(l.a,{id:"hashtag.column_header.tag_mode.any",values:{additional:this.additionalFor("any")},defaultMessage:"or {additional}"},"any")),this.additionalFor("all")&&e.push(" ",Object(s.a)(l.a,{id:"hashtag.column_header.tag_mode.all",values:{additional:this.additionalFor("all")},defaultMessage:"and {additional}"},"all")),this.additionalFor("none")&&e.push(" ",Object(s.a)(l.a,{id:"hashtag.column_header.tag_mode.none",values:{additional:this.additionalFor("none")},defaultMessage:"without {additional}"},"none")),e})),Object(n.a)(this,"additionalFor",(t=>{const{tags:e}=this.props.params;return e&&(e[t]||[]).length>0?e[t].map((t=>t.value)).join("/"):""})),Object(n.a)(this,"handleMove",(t=>{const{columnId:e,dispatch:a}=this.props;a(Object(g.g)(e,t))})),Object(n.a)(this,"handleHeaderClick",(()=>{this.column.scrollTop()})),Object(n.a)(this,"setRef",(t=>{this.column=t})),Object(n.a)(this,"handleLoadMore",(t=>{const{dispatch:e,params:a}=this.props,{id:s,tags:n,local:o}=a;e(Object(m.u)(s,{maxId:t,tags:n,local:o}))})),Object(n.a)(this,"handleFollow",(()=>{const{dispatch:t,params:e,tag:a}=this.props,{id:s}=e,{signedIn:n}=this.props.identity;n&&(a.get("following")?t(Object(p.p)(s)):t(Object(p.o)(s)))}))}_subscribe(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{signedIn:n}=this.props.identity;if(!n)return;let o=(a.any||[]).map((t=>t.value)),i=(a.all||[]).map((t=>t.value)),c=(a.none||[]).map((t=>t.value));[e,...o].map((a=>{this.disconnects.push(t(Object(u.c)(e,a,s,(t=>{let e=t.tags.map((t=>t.name));return i.filter((t=>e.includes(t))).length===i.length&&0===c.filter((t=>e.includes(t))).length}))))}))}_unsubscribe(){this.disconnects.map((t=>t())),this.disconnects=[]}_unload(){const{dispatch:t}=this.props,{id:e,local:a}=this.props.params;this._unsubscribe(),t(Object(m.m)("hashtag:".concat(e).concat(a?":local":"")))}_load(){const{dispatch:t}=this.props,{id:e,tags:a,local:s}=this.props.params;this._subscribe(t,e,a,s),t(Object(m.u)(e,{tags:a,local:s})),t(Object(p.n)(e))}componentDidMount(){this._load()}componentDidUpdate(t){const{params:e}=this.props,{id:a,tags:s,local:n}=t.params;a===e.id&&i()(s,e.tags)&&i()(n,e.local)||(this._unload(),this._load())}componentWillUnmount(){this._unsubscribe()}render(){const{hasUnread:t,columnId:e,multiColumn:a,tag:n}=this.props,{id:o,local:i}=this.props.params,c=!!e,{signedIn:h}=this.props.identity;return Object(J.jsxs)(b.a,{bindToDocument:!a,ref:this.setRef,label:"#".concat(o),children:[Object(s.a)(O.b,{icon:"hashtag",iconComponent:r.a,active:t,title:this.title(),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:c,multiColumn:a,showBackButton:!0},void 0,e&&Object(s.a)(D,{columnId:e})),Object(s.a)(_.a,{prepend:c?null:Object(s.a)(S,{tag:n,disabled:!h,onClick:this.handleFollow}),alwaysPrepend:!0,trackScroll:!c,scrollKey:"hashtag_timeline-".concat(e),timelineId:"hashtag:".concat(o).concat(i?":local":""),onLoadMore:this.handleLoadMore,emptyMessage:Object(s.a)(l.a,{id:"empty_column.hashtag",defaultMessage:"There is nothing in this hashtag yet."}),bindToDocument:!a}),Object(s.a)(d.a,{},void 0,Object(s.a)("title",{},void 0,"#",o),Object(s.a)("meta",{name:"robots",content:"noindex"}))]})}}e.default=Object(h.connect)(((t,e)=>({hasUnread:t.getIn(["timelines","hashtag:".concat(e.params.id).concat(e.params.local?":local":""),"unread"])>0,tag:t.getIn(["tags",e.params.id])})))(Object(j.e)(q))}}]);
//# sourceMappingURL=hashtag_timeline.js.map