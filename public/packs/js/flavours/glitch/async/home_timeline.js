(window.webpackJsonp=window.webpackJsonp||[]).push([[519],{1712:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(0),s=n(31);const i=e=>{let{id:t,icon:n,count:i,issueBadge:o,className:c}=e;return Object(a.a)("i",{className:"icon-with-badge"},void 0,Object(a.a)(s.a,{id:t,icon:n,className:c}),i>0&&Object(a.a)("i",{className:"icon-with-badge__badge"},void 0,(r=i)>40?"40+":r),o&&Object(a.a)("i",{className:"icon-with-badge__issue-badge"}));var r}},1980:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n(2),i=(n(45),n(14),n(1)),o=n(8),c=n(26),r=n(54),d=n(9),l=n.n(d),u=n(247),m=n(10),h=n(2065),p=n(529),g=n(226),b=n(1712),j=n(2118),v=n(198),O=n(5),_=(n(59),n(4)),f=n.n(_),M=n(46),R=n(24),y=n.n(R),x=n(37),k=n(560),C=n.n(k),w=n(127),I=n.n(w),N=n(555),A=n.n(N),P=n(538),q=n(530),S=n(319),L=n(283),z=n(1216),E=n(31),D=n(51),T=n(1240),F=n(296),Y=n(12),H=n(245),K=n(191),U=n(6);const B=Object(o.d)({close:{id:"lightbox.close",defaultMessage:"Close"},previous:{id:"lightbox.previous",defaultMessage:"Previous"},next:{id:"lightbox.next",defaultMessage:"Next"}});class J extends x.a{constructor(){super(...arguments),Object(s.a)(this,"setRef",(e=>{this.node=e})),Object(s.a)(this,"onMentionClick",((e,t)=>{!this.props.history||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.props.history.push("/@".concat(e.get("acct"))))})),Object(s.a)(this,"onHashtagClick",((e,t)=>{e=e.replace(/^#/,""),!this.props.history||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.props.history.push("/tags/".concat(e)))})),Object(s.a)(this,"onStatusClick",((e,t)=>{!this.props.history||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.props.history.push("/@".concat(e.getIn(["account","acct"]),"/").concat(e.get("id"))))})),Object(s.a)(this,"handleMouseEnter",(e=>{let{currentTarget:t}=e;if(Y.a)return;const n=t.querySelectorAll(".custom-emoji");for(var a=0;a<n.length;a++){let e=n[a];e.src=e.getAttribute("data-original")}})),Object(s.a)(this,"handleMouseLeave",(e=>{let{currentTarget:t}=e;if(Y.a)return;const n=t.querySelectorAll(".custom-emoji");for(var a=0;a<n.length;a++){let e=n[a];e.src=e.getAttribute("data-static")}}))}componentDidMount(){this._updateLinks()}componentDidUpdate(){this._updateLinks()}_updateLinks(){const e=this.node;if(!e)return;const t=e.querySelectorAll("a");for(var n=0;n<t.length;++n){let e=t[n];if(e.classList.contains("status-link"))continue;e.classList.add("status-link");let a=this.props.announcement.get("mentions").find((t=>e.href===t.get("url")));if(a)e.addEventListener("click",this.onMentionClick.bind(this,a),!1),e.setAttribute("title",a.get("acct"));else if("#"===e.textContent[0]||e.previousSibling&&e.previousSibling.textContent&&"#"===e.previousSibling.textContent[e.previousSibling.textContent.length-1])e.addEventListener("click",this.onHashtagClick.bind(this,e.text),!1);else{let t=this.props.announcement.get("statuses").find((t=>e.href===t.get("url")));t&&e.addEventListener("click",this.onStatusClick.bind(this,t),!1),e.setAttribute("title",e.href),e.classList.add("unhandled-link")}e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")}}render(){const{announcement:e}=this.props;return Object(U.jsx)("div",{className:"announcements__item__content translate",ref:this.setRef,dangerouslySetInnerHTML:{__html:e.get("contentHtml")},onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave})}}Object(s.a)(J,"propTypes",{announcement:y.a.map.isRequired,...K.b});const W=Object(M.k)(J);class G extends i.PureComponent{render(){const{emoji:e,emojiMap:t,hovered:n}=this.props;if(F.a[e]){const{filename:t,shortCode:n}=F.a[this.props.emoji],s=n?":".concat(n,":"):"";return Object(a.a)("img",{draggable:"false",className:"emojione",alt:e,title:s,src:"".concat(H.a,"/emoji/").concat(t,".svg")})}if(t.get(e)){const s=Y.a||n?t.getIn([e,"url"]):t.getIn([e,"static_url"]),i=":".concat(e,":");return Object(a.a)("img",{draggable:"false",className:"emojione custom-emoji",alt:i,title:i,src:s})}return null}}class Q extends x.a{constructor(){super(...arguments),Object(s.a)(this,"state",{hovered:!1}),Object(s.a)(this,"handleClick",(()=>{const{reaction:e,announcementId:t,addReaction:n,removeReaction:a}=this.props;e.get("me")?a(t,e.get("name")):n(t,e.get("name"))})),Object(s.a)(this,"handleMouseEnter",(()=>this.setState({hovered:!0}))),Object(s.a)(this,"handleMouseLeave",(()=>this.setState({hovered:!1})))}render(){const{reaction:e}=this.props;let t=e.get("name");return F.a[t]&&(t=F.a[t].shortCode),Object(a.a)("button",{className:l()("reactions-bar__item",{active:e.get("me")}),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,title:":".concat(t,":"),style:this.props.style},void 0,Object(a.a)("span",{className:"reactions-bar__item__emoji"},void 0,Object(a.a)(G,{hovered:this.state.hovered,emoji:e.get("name"),emojiMap:this.props.emojiMap})),Object(a.a)("span",{className:"reactions-bar__item__count"},void 0,Object(a.a)(z.a,{value:e.get("count")})))}}Object(s.a)(Q,"propTypes",{announcementId:f.a.string.isRequired,reaction:y.a.map.isRequired,addReaction:f.a.func.isRequired,removeReaction:f.a.func.isRequired,emojiMap:y.a.map.isRequired,style:f.a.object});class V extends x.a{constructor(){super(...arguments),Object(s.a)(this,"handleEmojiPick",(e=>{const{addReaction:t,announcementId:n}=this.props;t(n,e.native.replace(/:/g,""))}))}willEnter(){return{scale:Y.z?1:0}}willLeave(){return{scale:Y.z?0:I()(0,{stiffness:170,damping:26})}}render(){const{reactions:e}=this.props,t=e.filter((e=>e.get("count")>0)),n=t.map((e=>({key:e.get("name"),data:e,style:{scale:Y.z?1:I()(1,{stiffness:150,damping:13})}}))).toArray();return Object(a.a)(C.a,{styles:n,willEnter:this.willEnter,willLeave:this.willLeave},void 0,(e=>Object(a.a)("div",{className:l()("reactions-bar",{"reactions-bar--empty":t.isEmpty()})},void 0,e.map((e=>{let{key:t,data:n,style:s}=e;return Object(a.a)(Q,{reaction:n,style:{transform:"scale(".concat(s.scale,")"),position:s.scale<.5?"absolute":"static"},announcementId:this.props.announcementId,addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap},t)})),t.size<8&&Object(a.a)(T.a,{onPickEmoji:this.handleEmojiPick,button:Object(a.a)(E.a,{id:"plus",icon:q.a})}))))}}Object(s.a)(V,"propTypes",{announcementId:f.a.string.isRequired,reactions:y.a.list.isRequired,addReaction:f.a.func.isRequired,removeReaction:f.a.func.isRequired,emojiMap:y.a.map.isRequired});class X extends x.a{constructor(){super(...arguments),Object(s.a)(this,"state",{unread:!this.props.announcement.get("read")})}componentDidUpdate(){const{selected:e,announcement:t}=this.props;e||this.state.unread===!t.get("read")||this.setState({unread:!t.get("read")})}render(){const{announcement:e}=this.props,{unread:t}=this.state,n=e.get("starts_at")&&new Date(e.get("starts_at")),s=e.get("ends_at")&&new Date(e.get("ends_at")),i=new Date,r=n&&s,d=r&&n.getFullYear()===s.getFullYear()&&s.getFullYear()===i.getFullYear(),l=r&&n.getDate()===s.getDate()&&n.getMonth()===s.getMonth()&&n.getFullYear()===s.getFullYear(),u=e.get("all_day");return Object(a.a)("div",{className:"announcements__item"},void 0,Object(a.a)("strong",{className:"announcements__item__range"},void 0,Object(a.a)(c.a,{id:"announcement.announcement",defaultMessage:"Announcement"}),r&&Object(a.a)("span",{},void 0," Â· ",Object(a.a)(o.a,{value:n,year:d||n.getFullYear()===i.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:u?void 0:"2-digit",minute:u?void 0:"2-digit"})," - ",Object(a.a)(o.a,{value:s,year:d||s.getFullYear()===i.getFullYear()?void 0:"numeric",month:l?void 0:"short",day:l?void 0:"2-digit",hour:u?void 0:"2-digit",minute:u?void 0:"2-digit"}))),Object(a.a)(W,{announcement:e}),Object(a.a)(V,{reactions:e.get("reactions"),announcementId:e.get("id"),addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap}),t&&Object(a.a)("span",{className:"announcements__item__unread"}))}}Object(s.a)(X,"propTypes",{announcement:y.a.map.isRequired,emojiMap:y.a.map.isRequired,addReaction:f.a.func.isRequired,removeReaction:f.a.func.isRequired,intl:f.a.object.isRequired,selected:f.a.bool});class Z extends x.a{constructor(){super(...arguments),Object(s.a)(this,"state",{index:0}),Object(s.a)(this,"handleChangeIndex",(e=>{this.setState({index:e%this.props.announcements.size})})),Object(s.a)(this,"handleNextClick",(()=>{this.setState({index:(this.state.index+1)%this.props.announcements.size})})),Object(s.a)(this,"handlePrevClick",(()=>{this.setState({index:(this.props.announcements.size+this.state.index-1)%this.props.announcements.size})}))}static getDerivedStateFromProps(e,t){return e.announcements.size>0&&t.index>=e.announcements.size?{index:e.announcements.size-1}:null}componentDidMount(){this._markAnnouncementAsRead()}componentDidUpdate(){this._markAnnouncementAsRead()}_markAnnouncementAsRead(){const{dismissAnnouncement:e,announcements:t}=this.props,{index:n}=this.state,a=t.get(t.size-1-n);a.get("read")||e(a.get("id"))}render(){const{announcements:e,intl:t}=this.props,{index:n}=this.state;return e.isEmpty()?null:Object(a.a)("div",{className:"announcements"},void 0,Object(a.a)("img",{className:"announcements__mastodon",alt:"",draggable:"false",src:Y.r||P.default}),Object(a.a)("div",{className:"announcements__container"},void 0,Object(a.a)(A.a,{animateHeight:!0,animateTransitions:!Y.z,index:n,onChangeIndex:this.handleChangeIndex},void 0,e.map(((e,s)=>Object(a.a)(X,{announcement:e,emojiMap:this.props.emojiMap,addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,intl:t,selected:n===s,disabled:Y.h},e.get("id")))).reverse()),e.size>1&&Object(a.a)("div",{className:"announcements__pagination"},void 0,Object(a.a)(D.a,{disabled:1===e.size,title:t.formatMessage(B.previous),icon:"chevron-left",iconComponent:S.a,onClick:this.handlePrevClick,size:13}),Object(a.a)("span",{},void 0,n+1," / ",e.size),Object(a.a)(D.a,{disabled:1===e.size,title:t.formatMessage(B.next),icon:"chevron-right",iconComponent:L.a,onClick:this.handleNextClick,size:13}))))}}Object(s.a)(Z,"propTypes",{announcements:y.a.list,emojiMap:y.a.map.isRequired,dismissAnnouncement:f.a.func.isRequired,addReaction:f.a.func.isRequired,removeReaction:f.a.func.isRequired,intl:f.a.object.isRequired});var $=Object(r.c)(Z);const ee=Object(v.a)([e=>e.get("custom_emojis")],(e=>e.reduce(((e,t)=>e.set(t.get("shortcode"),t)),Object(O.Map)())));var te=Object(m.connect)((e=>({announcements:e.getIn(["announcements","items"]),emojiMap:ee(e)})),(e=>({dismissAnnouncement:t=>e(Object(g.o)(t)),addReaction:(t,n)=>e(Object(g.m)(t,n)),removeReaction:(t,n)=>e(Object(g.q)(t,n))})))($),ne=n(126),ae=n(537),se=n(85),ie=n(1291),oe=n(1289),ce=n(2066),re=n(71),de=n(2076),le=n(88),ue=n(166),me=n(2070);const he=Object(o.d)({filter_regex:{id:"home.column_settings.filter_regex",defaultMessage:"Filter out by regular expressions"},settings:{id:"home.settings",defaultMessage:"Column settings"}}),pe=()=>{const e=Object(le.c)((e=>e.settings.get("home"))),t=Object(re.a)(),n=Object(le.b)(),s=Object(i.useCallback)(((e,t)=>{n(Object(ue.c)(["home",...e],t))}),[n]);return Object(a.a)("div",{className:"column-settings"},void 0,Object(a.a)("section",{},void 0,Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(me.a,{prefix:"home_timeline",settings:e,settingPath:["shows","reblog"],onChange:s,label:Object(a.a)(c.a,{id:"home.column_settings.show_reblogs",defaultMessage:"Show boosts"})}),Object(a.a)(me.a,{prefix:"home_timeline",settings:e,settingPath:["shows","reply"],onChange:s,label:Object(a.a)(c.a,{id:"home.column_settings.show_replies",defaultMessage:"Show replies"})}),Object(a.a)(me.a,{prefix:"home_timeline",settings:e,settingPath:["shows","direct"],onChange:s,label:Object(a.a)(c.a,{id:"home.column_settings.show_direct",defaultMessage:"Show private mentions"})}))),Object(a.a)("section",{"aria-labelledby":"home-column-advanced"},void 0,Object(a.a)("h3",{id:"home-column-advanced"},void 0,Object(a.a)(c.a,{id:"home.column_settings.advanced",defaultMessage:"Advanced"})),Object(a.a)("div",{className:"column-settings__row"},void 0,Object(a.a)(de.a,{prefix:"home_timeline",settings:e,settingPath:["regex","body"],onChange:s,label:t.formatMessage(he.filter_regex)}))))},ge=()=>Object(a.a)("div",{className:"warning-banner"},void 0,Object(a.a)("div",{className:"warning-banner__message"},void 0,Object(a.a)("h1",{},void 0,Object(a.a)(c.a,{id:"home.pending_critical_update.title",defaultMessage:"Critical security update available!"})),Object(a.a)("p",{},void 0,Object(a.a)(c.a,{id:"home.pending_critical_update.body",defaultMessage:"Please update your Mastodon server as soon as possible!"})," ",Object(a.a)("a",{href:"/admin/software_updates"},void 0,Object(a.a)(c.a,{id:"home.pending_critical_update.link",defaultMessage:"See updates"}))))),be=Object(o.d)({title:{id:"column.home",defaultMessage:"Home"},show_announcements:{id:"home.show_announcements",defaultMessage:"Show announcements"},hide_announcements:{id:"home.hide_announcements",defaultMessage:"Hide announcements"}});class je extends i.PureComponent{constructor(){super(...arguments),Object(s.a)(this,"handlePin",(()=>{const{columnId:e,dispatch:t}=this.props;t(e?Object(ae.h)(e):Object(ae.e)("HOME",{}))})),Object(s.a)(this,"handleMove",(e=>{const{columnId:t,dispatch:n}=this.props;n(Object(ae.g)(t,e))})),Object(s.a)(this,"handleHeaderClick",(()=>{this.column.scrollTop()})),Object(s.a)(this,"setRef",(e=>{this.column=e})),Object(s.a)(this,"handleLoadMore",(e=>{this.props.dispatch(Object(se.w)({maxId:e}))})),Object(s.a)(this,"handleToggleAnnouncementsClick",(e=>{e.stopPropagation(),this.props.dispatch(Object(g.r)())}))}componentDidMount(){setTimeout((()=>this.props.dispatch(Object(g.p)())),700),this._checkIfReloadNeeded(!1,this.props.isPartial)}componentDidUpdate(e){this._checkIfReloadNeeded(e.isPartial,this.props.isPartial)}componentWillUnmount(){this._stopPolling()}_checkIfReloadNeeded(e,t){const{dispatch:n}=this.props;e!==t&&(!e&&t?this.polling=setInterval((()=>{n(Object(se.w)())}),3e3):e&&!t&&this._stopPolling())}_stopPolling(){this.polling&&(clearInterval(this.polling),this.polling=null)}render(){const{intl:e,hasUnread:t,columnId:n,multiColumn:s,hasAnnouncements:i,unreadAnnouncements:o,showAnnouncements:r}=this.props,d=!!n,{signedIn:m}=this.props.identity,g=[];let v;return i&&(v=Object(a.a)("button",{className:l()("column-header__button",{active:r}),title:e.formatMessage(r?be.hide_announcements:be.show_announcements),"aria-label":e.formatMessage(r?be.hide_announcements:be.show_announcements),onClick:this.handleToggleAnnouncementsClick},void 0,Object(a.a)(b.a,{id:"bullhorn",icon:h.a,count:o}))),Y.c&&g.push(Object(a.a)(ge,{},"critical-update-banner")),Object(U.jsxs)(ie.a,{bindToDocument:!s,ref:this.setRef,label:e.formatMessage(be.title),children:[Object(a.a)(oe.b,{icon:"home",iconComponent:p.a,active:t,title:e.formatMessage(be.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:d,multiColumn:s,extraButton:v,appendContent:i&&r&&Object(a.a)(te,{})},void 0,Object(a.a)(pe,{})),m?Object(a.a)(ce.a,{prepend:g,alwaysPrepend:!0,trackScroll:!d,scrollKey:"home_timeline-".concat(n),onLoadMore:this.handleLoadMore,timelineId:"home",emptyMessage:Object(a.a)(c.a,{id:"empty_column.home",defaultMessage:"Your home timeline is empty! Follow more people to fill it up."}),bindToDocument:!s,regex:this.props.regex}):Object(a.a)(j.a,{}),Object(a.a)(u.a,{},void 0,Object(a.a)("title",{},void 0,e.formatMessage(be.title)),Object(a.a)("meta",{name:"robots",content:"noindex"}))]})}}t.default=Object(m.connect)((e=>({hasUnread:e.getIn(["timelines","home","unread"])>0,isPartial:e.getIn(["timelines","home","isPartial"]),hasAnnouncements:!e.getIn(["announcements","items"]).isEmpty(),unreadAnnouncements:e.getIn(["announcements","items"]).count((e=>!e.get("read"))),showAnnouncements:e.getIn(["announcements","show"]),regex:e.getIn(["settings","home","regex","body"])})))(Object(ne.e)(Object(r.c)(je)))}}]);
//# sourceMappingURL=home_timeline.js.map