(window.webpackJsonp=window.webpackJsonp||[]).push([[537],{1974:function(t,e,s){"use strict";s.r(e);var a,i=s(0),o=s(2),n=(s(45),s(180),s(14),s(4)),d=s.n(n),l=s(8),c=s(54),r=s(9),h=s.n(r),u=s(247),p=s(46),g=s(198),b=s(5),m=s(24),O=s.n(m),f=s(37),v=s(10),j=s(190),_=s(1);function M(){return M=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var a in s)({}).hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},M.apply(null,arguments)}var y=function(t){let{title:e,titleId:s,...i}=t;return _.createElement("svg",M({xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 -960 960 960",width:24,"aria-labelledby":s},i),e?_.createElement("title",{id:s},e):null,a||(a=_.createElement("path",{d:"M240-400h320v-80H240v80Zm0-120h480v-80H240v80Zm0-120h480v-80H240v80ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"})))},k=s(1195),C=s(308),I=s(31),R=s(429),w=s(1875),x=s(1271),T=s(126),H=s(1218),N=s(191),E=s(400),P=s(22),D=s(69),S=s(477),B=s(49),A=s(328),V=s(1722),F=s(148),U=s(1289),q=s(1723),z=s(1190),K=s(12),L=s(231),W=s(2062),Z=s(418),J=(s(59),s(1693)),G=s(1673),Q=s(1194),Y=s(194),X=s(221),$=s(257),tt=s(386),et=s(300),st=s(316),at=s(1196),it=s(1667),ot=s(1668),nt=s(1197),dt=s(239),lt=s(235),ct=s(51),rt=s(482),ht=s(1240);const ut=Object(l.d)({delete:{id:"status.delete",defaultMessage:"Delete"},redraft:{id:"status.redraft",defaultMessage:"Delete & re-draft"},edit:{id:"status.edit",defaultMessage:"Edit"},direct:{id:"status.direct",defaultMessage:"Privately mention @{name}"},mention:{id:"status.mention",defaultMessage:"Mention @{name}"},reply:{id:"status.reply",defaultMessage:"Reply"},reblog:{id:"status.reblog",defaultMessage:"Boost"},reblog_private:{id:"status.reblog_private",defaultMessage:"Boost with original visibility"},cancel_reblog_private:{id:"status.cancel_reblog_private",defaultMessage:"Unboost"},cannot_reblog:{id:"status.cannot_reblog",defaultMessage:"This post cannot be boosted"},favourite:{id:"status.favourite",defaultMessage:"Favorite"},react:{id:"status.react",defaultMessage:"React"},bookmark:{id:"status.bookmark",defaultMessage:"Bookmark"},more:{id:"status.more",defaultMessage:"More"},mute:{id:"status.mute",defaultMessage:"Mute @{name}"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"},block:{id:"status.block",defaultMessage:"Block @{name}"},report:{id:"status.report",defaultMessage:"Report @{name}"},share:{id:"status.share",defaultMessage:"Share"},pin:{id:"status.pin",defaultMessage:"Pin on profile"},unpin:{id:"status.unpin",defaultMessage:"Unpin from profile"},embed:{id:"status.embed",defaultMessage:"Embed"},admin_account:{id:"status.admin_account",defaultMessage:"Open moderation interface for @{name}"},admin_status:{id:"status.admin_status",defaultMessage:"Open this post in the moderation interface"},admin_domain:{id:"status.admin_domain",defaultMessage:"Open moderation interface for {domain}"},copy:{id:"status.copy",defaultMessage:"Copy link to post"},openOriginalPage:{id:"account.open_original_page",defaultMessage:"Open original page"}});class pt extends _.PureComponent{constructor(){super(...arguments),Object(o.a)(this,"handleReplyClick",(()=>{this.props.onReply(this.props.status)})),Object(o.a)(this,"handleReblogClick",(t=>{this.props.onReblog(this.props.status,t)})),Object(o.a)(this,"handleFavouriteClick",(t=>{this.props.onFavourite(this.props.status,t)})),Object(o.a)(this,"handleEmojiPick",(t=>{this.props.onReactionAdd(this.props.status.get("id"),t.native.replace(/:/g,""),t.imageUrl)})),Object(o.a)(this,"handleBookmarkClick",(t=>{this.props.onBookmark(this.props.status,t)})),Object(o.a)(this,"handleDeleteClick",(()=>{this.props.onDelete(this.props.status,this.props.history)})),Object(o.a)(this,"handleRedraftClick",(()=>{this.props.onDelete(this.props.status,this.props.history,!0)})),Object(o.a)(this,"handleEditClick",(()=>{this.props.onEdit(this.props.status,this.props.history)})),Object(o.a)(this,"handleDirectClick",(()=>{this.props.onDirect(this.props.status.get("account"),this.props.history)})),Object(o.a)(this,"handleMentionClick",(()=>{this.props.onMention(this.props.status.get("account"),this.props.history)})),Object(o.a)(this,"handleMuteClick",(()=>{this.props.onMute(this.props.status.get("account"))})),Object(o.a)(this,"handleBlockClick",(()=>{this.props.onBlock(this.props.status)})),Object(o.a)(this,"handleConversationMuteClick",(()=>{this.props.onMuteConversation(this.props.status)})),Object(o.a)(this,"handleReport",(()=>{this.props.onReport(this.props.status)})),Object(o.a)(this,"handlePinClick",(()=>{this.props.onPin(this.props.status)})),Object(o.a)(this,"handleShare",(()=>{navigator.share({url:this.props.status.get("url")})})),Object(o.a)(this,"handleEmbed",(()=>{this.props.onEmbed(this.props.status)})),Object(o.a)(this,"handleCopy",(()=>{const t=this.props.status.get("url");navigator.clipboard.writeText(t)}))}render(){const{status:t,intl:e}=this.props,{signedIn:s,permissions:a}=this.props.identity,o=["public","unlisted"].includes(t.get("visibility")),n=["public","unlisted","private"].includes(t.get("visibility")),d=t.get("muted"),l=t.getIn(["account","id"])===K.u,c=t.getIn(["account","username"])!==t.getIn(["account","acct"]);let r,u,p=[];if(o&&c&&p.push({text:e.formatMessage(ut.openOriginalPage),href:t.get("url")}),p.push({text:e.formatMessage(ut.copy),action:this.handleCopy}),o&&"share"in navigator&&p.push({text:e.formatMessage(ut.share),action:this.handleShare}),!o||!s&&c||p.push({text:e.formatMessage(ut.embed),action:this.handleEmbed}),s)if(p.push(null),l)n&&(p.push({text:e.formatMessage(t.get("pinned")?ut.unpin:ut.pin),action:this.handlePinClick}),p.push(null)),p.push({text:e.formatMessage(d?ut.unmuteConversation:ut.muteConversation),action:this.handleConversationMuteClick}),p.push(null),p.push({text:e.formatMessage(ut.edit),action:this.handleEditClick}),p.push({text:e.formatMessage(ut.delete),action:this.handleDeleteClick,dangerous:!0}),p.push({text:e.formatMessage(ut.redraft),action:this.handleRedraftClick,dangerous:!0});else if(p.push({text:e.formatMessage(ut.mention,{name:t.getIn(["account","username"])}),action:this.handleMentionClick}),p.push({text:e.formatMessage(ut.direct,{name:t.getIn(["account","username"])}),action:this.handleDirectClick}),p.push(null),p.push({text:e.formatMessage(ut.mute,{name:t.getIn(["account","username"])}),action:this.handleMuteClick,dangerous:!0}),p.push({text:e.formatMessage(ut.block,{name:t.getIn(["account","username"])}),action:this.handleBlockClick,dangerous:!0}),p.push({text:e.formatMessage(ut.report,{name:t.getIn(["account","username"])}),action:this.handleReport,dangerous:!0}),((a&dt.d)===dt.d&&(lt.a||lt.e)||c&&(a&dt.b)===dt.b)&&(p.push(null),(a&dt.d)===dt.d&&(void 0!==lt.a&&p.push({text:e.formatMessage(ut.admin_account,{name:t.getIn(["account","username"])}),href:Object(lt.a)(t.getIn(["account","id"]))}),void 0!==lt.e&&p.push({text:e.formatMessage(ut.admin_status),href:Object(lt.e)(t.getIn(["account","id"]),t.get("id"))})),c&&(a&dt.b)===dt.b)){const s=t.getIn(["account","acct"]).split("@")[1];p.push({text:e.formatMessage(ut.admin_domain,{domain:s}),href:"/admin/instances/".concat(s)})}null===t.get("in_reply_to_id",null)?(r="reply",u=$.a):(r="reply-all",u=tt.a);const g=s&&t.get("reactions").filter((t=>t.get("count")>0&&t.get("me"))).size<K.t,b=t.getIn(["account","id"])===K.u&&"private"===t.get("visibility");let m,O;return t.get("reblogged")?(m=e.formatMessage(ut.cancel_reblog_private),O=o?at.a:nt.a):o?(m=e.formatMessage(ut.reblog),O=X.a):b?(m=e.formatMessage(ut.reblog_private),O=ot.a):(m=e.formatMessage(ut.cannot_reblog),O=it.a),Object(i.a)("div",{className:"detailed-status__action-bar"},void 0,Object(i.a)("div",{className:"detailed-status__button"},void 0,Object(i.a)(ct.a,{title:e.formatMessage(ut.reply),icon:r,iconComponent:u,onClick:this.handleReplyClick})),Object(i.a)("div",{className:"detailed-status__button"},void 0,Object(i.a)(ct.a,{className:h()({reblogPrivate:b}),disabled:!o&&!b,active:t.get("reblogged"),title:m,icon:"retweet",iconComponent:O,onClick:this.handleReblogClick})),Object(i.a)("div",{className:"detailed-status__button"},void 0,Object(i.a)(ct.a,{className:"star-icon",animate:!0,active:t.get("favourited"),title:e.formatMessage(ut.favourite),icon:"star",iconComponent:t.get("favourited")?et.a:st.a,onClick:this.handleFavouriteClick})),Object(i.a)("div",{className:"detailed-status__button"},void 0,Object(i.a)(ht.a,{onPickEmoji:this.handleEmojiPick,title:e.formatMessage(ut.react),icon:J.a,disabled:!g})),Object(i.a)("div",{className:"detailed-status__button"},void 0,Object(i.a)(ct.a,{className:"bookmark-icon",disabled:!s,active:t.get("bookmarked"),title:e.formatMessage(ut.bookmark),icon:"bookmark",iconComponent:t.get("bookmarked")?G.a:Q.a,onClick:this.handleBookmarkClick})),Object(i.a)("div",{className:"detailed-status__action-bar-dropdown"},void 0,Object(i.a)(rt.a,{size:18,icon:"ellipsis-h",iconComponent:Y.a,items:p,direction:"left",title:e.formatMessage(ut.more)})))}}var gt=Object(p.k)(Object(T.e)(Object(c.c)(pt))),bt=s(26),mt=s(40),Ot=s(1216),ft=s(523),vt=s(2122),jt=s(234),_t=s(526),Mt=s(1243),yt=s(1685);var kt=Object(v.connect)(((t,e)=>{let{statusId:s}=e;return{openDropdownId:t.dropdownMenu.openId,openedViaKeyboard:t.dropdownMenu.keyboard,items:t.getIn(["history",s,"items"]),loading:t.getIn(["history",s,"loading"])}}),((t,e)=>{let{statusId:s}=e;return{onOpen(e,a,i){t(Object(Mt.d)(s)),t(Object(_t.b)({id:e,keyboard:i}))},onClose(e){t(Object(_t.a)({id:e}))}}}))(yt.a);class Ct extends _.PureComponent{constructor(){super(...arguments),Object(o.a)(this,"handleItemClick",((t,e)=>{const{onItemClick:s}=this.props;s(e)})),Object(o.a)(this,"renderHeader",(t=>Object(i.a)(bt.a,{id:"status.edited_x_times",defaultMessage:"Edited {count, plural, one {# time} other {# times}}",values:{count:t.size-1}}))),Object(o.a)(this,"renderItem",((t,e,s)=>{let{onClick:a,onKeyPress:o}=s;const n=Object(i.a)(jt.a,{timestamp:t.get("created_at"),short:!1}),d=Object(i.a)(vt.a,{accountId:t.get("account")}),l=t.get("original")?Object(i.a)(bt.a,{id:"status.history.created",defaultMessage:"{name} created {date}",values:{name:d,date:n}}):Object(i.a)(bt.a,{id:"status.history.edited",defaultMessage:"{name} edited {date}",values:{name:d,date:n}});return Object(i.a)("li",{className:"dropdown-menu__item edited-timestamp__history__item"},t.get("created_at"),Object(i.a)("button",{"data-index":e,onClick:a,onKeyPress:o},void 0,l))}))}render(){const{timestamp:t,intl:e,statusId:s}=this.props;return Object(i.a)(kt,{statusId:s,renderItem:this.renderItem,scrollable:!0,renderHeader:this.renderHeader,onItemClick:this.handleItemClick},void 0,Object(i.a)("button",{className:"dropdown-menu__text-button"},void 0,Object(i.a)(bt.a,{id:"status.edited",defaultMessage:"Edited {date}",values:{date:Object(i.a)("span",{className:"animated-number"},void 0,e.formatDate(t,{hourCycle:"h23",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}))}})))}}var It=Object(v.connect)(null,((t,e)=>{let{statusId:s}=e;return{onItemClick(e){t(Object(B.b)({modalType:"COMPARE_HISTORY",modalProps:{index:e,statusId:s}}))}}}))(Object(c.c)(Ct)),Rt=s(1692),wt=s(1687),xt=s(524),Tt=s(1701),Ht=s(167),Nt=s(187),Et=s(1876),Pt=s(413),Dt=s(1695),St=s(519),Bt=s(1863),At=s(259),Vt=s(1675),Ft=s(6);class Ut extends f.a{constructor(){super(...arguments),Object(o.a)(this,"state",{height:null}),Object(o.a)(this,"handleAccountClick",(t=>{0===t.button&&!(t.ctrlKey||t.altKey||t.metaKey)&&this.props.history&&(t.preventDefault(),this.props.history.push("/@".concat(this.props.status.getIn(["account","acct"])))),t.stopPropagation()})),Object(o.a)(this,"parseClick",((t,e)=>{0===t.button&&!(t.ctrlKey||t.altKey||t.metaKey)&&this.props.history&&(t.preventDefault(),this.props.history.push(e)),t.stopPropagation()})),Object(o.a)(this,"handleOpenVideo",(t=>{this.props.onOpenVideo(this.props.status.getIn(["media_attachments",0]),t)})),Object(o.a)(this,"setRef",(t=>{this.node=t,this._measureHeight()})),Object(o.a)(this,"handleChildUpdate",(()=>{this._measureHeight()})),Object(o.a)(this,"handleModalLink",(t=>{let e;t.preventDefault(),e="A"!==t.target.nodeName?t.target.parentNode.href:t.target.href,window.open(e,"mastodon-intent","width=445,height=600,resizable=no,menubar=no,status=no,scrollbars=yes")})),Object(o.a)(this,"handleTranslate",(()=>{const{onTranslate:t,status:e}=this.props;t(e)}))}_measureHeight(t){this.props.measureHeight&&this.node&&(Object(Bt.a)((()=>this.node&&this.setState({height:Math.ceil(this.node.scrollHeight)+1}))),this.props.onHeightChange&&t&&this.props.onHeightChange())}componentDidUpdate(t,e){this._measureHeight(e.height!==this.state.height)}render(){const t=this.props.status&&this.props.status.get("reblog")?this.props.status.get("reblog"):this.props.status,e={boxSizing:"border-box"},{compact:s,pictureInPicture:a,expanded:o,onToggleHidden:n,settings:d}=this.props;if(!t)return null;let c="",r="",u="",p=[],g=[],b=[],m=[],O=p,f=g;d.getIn(["content_warnings","media_outside"])&&(O=b,f=m),this.props.measureHeight&&(e.height="".concat(this.state.height,"px"));const v=t.getIn(["translation","language"])||t.get("language");if(a.get("inUse"))O.push(Object(i.a)(wt.a,{})),f.push("video-camera");else if(t.get("media_attachments").size>0)if(t.get("media_attachments").some((t=>"unknown"===t.get("type"))))O.push(Object(i.a)(ft.a,{media:t.get("media_attachments")}));else if("audio"===t.getIn(["media_attachments",0,"type"])){const e=t.getIn(["media_attachments",0]),s=e.getIn(["translation","description"])||e.get("description");O.push(Object(i.a)(St.default,{src:e.get("url"),alt:s,lang:v,duration:e.getIn(["meta","original","duration"],0),poster:e.get("preview_url")||t.getIn(["account","avatar_static"]),backgroundColor:e.getIn(["meta","colors","background"]),foregroundColor:e.getIn(["meta","colors","foreground"]),accentColor:e.getIn(["meta","colors","accent"]),sensitive:t.get("sensitive"),visible:this.props.showMedia,blurhash:e.get("blurhash"),height:150,onToggleVisibility:this.props.onToggleMediaVisibility})),f.push("music")}else if("video"===t.getIn(["media_attachments",0,"type"])){const e=t.getIn(["media_attachments",0]),s=e.getIn(["translation","description"])||e.get("description");O.push(Object(i.a)(At.default,{preview:e.get("preview_url"),frameRate:e.getIn(["meta","original","frame_rate"]),blurhash:e.get("blurhash"),src:e.get("url"),alt:s,lang:v,inline:!0,sensitive:t.get("sensitive"),letterbox:d.getIn(["media","letterbox"]),fullwidth:d.getIn(["media","fullwidth"]),preventPlayback:!o,onOpenVideo:this.handleOpenVideo,autoplay:!0,visible:this.props.showMedia,onToggleVisibility:this.props.onToggleMediaVisibility})),f.push("video-camera")}else O.push(Object(i.a)(Et.default,{standalone:!0,sensitive:t.get("sensitive"),media:t.get("media_attachments"),lang:v,letterbox:d.getIn(["media","letterbox"]),fullwidth:d.getIn(["media","fullwidth"]),hidden:!o,onOpenMedia:this.props.onOpenMedia,visible:this.props.showMedia,onToggleVisibility:this.props.onToggleMediaVisibility})),f.push("picture-o");else t.get("card")&&(O.push(Object(i.a)(Vt.a,{sensitive:t.get("sensitive"),onOpenMedia:this.props.onOpenMedia,card:t.get("card")})),f.push("link"));t.get("poll")&&(p.push(Object(i.a)(Tt.a,{pollId:t.get("poll"),lang:t.get("language")})),g.push("tasks")),t.get("application")&&(c=Object(Ft.jsxs)(Ft.Fragment,{children:["·",Object(i.a)("a",{className:"detailed-status__application",href:t.getIn(["application","website"]),target:"_blank",rel:"noopener noreferrer"},void 0,t.getIn(["application","name"]))]}));const j=Object(Ft.jsxs)(Ft.Fragment,{children:["·",Object(i.a)(xt.a,{visibility:t.get("visibility")})]});r=["unlisted","public"].includes(t.get("visibility"))?this.props.history?Object(i.a)(mt.a,{to:"/@".concat(t.getIn(["account","acct"]),"/").concat(t.get("id"),"/reblogs"),className:"detailed-status__link"},void 0,Object(i.a)("span",{className:"detailed-status__reblogs"},void 0,Object(i.a)(Ot.a,{value:t.get("reblogs_count")})),Object(i.a)(bt.a,{id:"status.reblogs",defaultMessage:"{count, plural, one {boost} other {boosts}}",values:{count:t.get("reblogs_count")}})):Object(i.a)("a",{href:"/interact/".concat(t.get("id"),"?type=reblog"),className:"detailed-status__link",onClick:this.handleModalLink},void 0,Object(i.a)("span",{className:"detailed-status__reblogs"},void 0,Object(i.a)(Ot.a,{value:t.get("reblogs_count")})),Object(i.a)(bt.a,{id:"status.reblogs",defaultMessage:"{count, plural, one {boost} other {boosts}}",values:{count:t.get("reblogs_count")}})):null,u=this.props.history?Object(i.a)(mt.a,{to:"/@".concat(t.getIn(["account","acct"]),"/").concat(t.get("id"),"/favourites"),className:"detailed-status__link"},void 0,Object(i.a)("span",{className:"detailed-status__favorites"},void 0,Object(i.a)(Ot.a,{value:t.get("favourites_count")})),Object(i.a)(bt.a,{id:"status.favourites",defaultMessage:"{count, plural, one {favorite} other {favorites}}",values:{count:t.get("favourites_count")}})):Object(i.a)("a",{href:"/interact/".concat(t.get("id"),"?type=favourite"),className:"detailed-status__link",onClick:this.handleModalLink},void 0,Object(i.a)("span",{className:"detailed-status__favorites"},void 0,Object(i.a)(Ot.a,{value:t.get("favourites_count")})),Object(i.a)(bt.a,{id:"status.favourites",defaultMessage:"{count, plural, one {favorite} other {favorites}}",values:{count:t.get("favourites_count")}}));const{statusContentProps:_,hashtagBar:M}=Object(Rt.a)(t);return p.push(M),Object(i.a)("div",{style:e},void 0,Object(Ft.jsxs)("div",{ref:this.setRef,className:h()("detailed-status","detailed-status-".concat(t.get("visibility")),{compact:s}),"data-status-by":t.getIn(["account","acct"]),children:[Object(i.a)("a",{href:t.getIn(["account","url"]),"data-hover-card-account":t.getIn(["account","id"]),onClick:this.handleAccountClick,className:"detailed-status__display-name"},void 0,Object(i.a)("div",{className:"detailed-status__display-avatar"},void 0,Object(i.a)(Ht.a,{account:t.get("account"),size:48})),Object(i.a)(Nt.a,{account:t.get("account"),localDomain:this.props.domain})),Object(Ft.jsx)(Pt.a,{status:t,media:p,extraMedia:b,mediaIcons:g,expanded:o,collapsed:!1,onExpandedToggle:n,onTranslate:this.handleTranslate,parseClick:this.parseClick,onUpdate:this.handleChildUpdate,tagLinks:d.get("tag_misleading_links"),rewriteMentions:d.get("rewrite_mentions"),disabled:!0,..._}),K.O>0&&Object(i.a)(Dt.a,{statusId:t.get("id"),reactions:t.get("reactions"),addReaction:this.props.onReactionAdd,removeReaction:this.props.onReactionRemove,canReact:this.props.identity.signedIn}),Object(i.a)("div",{className:"detailed-status__meta"},void 0,Object(i.a)("div",{className:"detailed-status__meta__line"},void 0,Object(i.a)("a",{className:"detailed-status__datetime",href:t.get("url"),target:"_blank",rel:"noopener noreferrer"},void 0,Object(i.a)(l.a,{hourCycle:"h23",value:new Date(t.get("created_at")),year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})),j,c),t.get("edited_at")&&Object(i.a)("div",{className:"detailed-status__meta__line"},void 0,Object(i.a)(It,{statusId:t.get("id"),timestamp:t.get("edited_at")})),Object(i.a)("div",{className:"detailed-status__meta__line"},void 0,r,r&&Object(Ft.jsx)(Ft.Fragment,{children:"·"}),u))]}))}}Object(o.a)(Ut,"propTypes",{identity:T.c,status:O.a.map,settings:O.a.map.isRequired,onOpenMedia:d.a.func.isRequired,onOpenVideo:d.a.func.isRequired,onToggleHidden:d.a.func,onTranslate:d.a.func.isRequired,expanded:d.a.bool,measureHeight:d.a.bool,onHeightChange:d.a.func,domain:d.a.string.isRequired,compact:d.a.bool,showMedia:d.a.bool,pictureInPicture:O.a.contains({inUse:d.a.bool,available:d.a.bool}),onToggleMediaVisibility:d.a.func,onReactionAdd:d.a.func.isRequired,onReactionRemove:d.a.func.isRequired,...N.b});var qt=Object(p.k)(Object(T.e)(Ut));const zt=Object(l.d)({deleteConfirm:{id:"confirmations.delete.confirm",defaultMessage:"Delete"},deleteMessage:{id:"confirmations.delete.message",defaultMessage:"Are you sure you want to delete this status?"},redraftConfirm:{id:"confirmations.redraft.confirm",defaultMessage:"Delete & redraft"},redraftMessage:{id:"confirmations.redraft.message",defaultMessage:"Are you sure you want to delete this status and re-draft it? Favorites and boosts will be lost, and replies to the original post will be orphaned."},revealAll:{id:"status.show_more_all",defaultMessage:"Show more for all"},hideAll:{id:"status.show_less_all",defaultMessage:"Show less for all"},statusTitleWithAttachments:{id:"status.title.with_attachments",defaultMessage:"{user} posted {attachmentCount, plural, one {an attachment} other {# attachments}}"},detailedStatus:{id:"status.detailed_status",defaultMessage:"Detailed conversation view"},replyConfirm:{id:"confirmations.reply.confirm",defaultMessage:"Reply"},replyMessage:{id:"confirmations.reply.message",defaultMessage:"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?"},tootHeading:{id:"account.posts_with_replies",defaultMessage:"Posts and replies"}}),Kt=(t,e)=>{const s=e.getIn(["account","display_name"]),a=e.getIn(["account","username"]),i=0===s.trim().length?a:s,o=e.get("search_index"),n=e.get("media_attachments").size;return o?"".concat(i,': "').concat(((t,e)=>{const s=Array.from(t);return s.length>e?s.slice(0,e).join("")+"…":t})(o,30),'"'):t.formatMessage(zt.statusTitleWithAttachments,{user:i,attachmentCount:n})};class Lt extends f.a{constructor(){var t;super(...arguments),t=this,Object(o.a)(this,"state",{fullscreen:!1,isExpanded:void 0,threadExpanded:void 0,statusId:void 0,loadedStatusId:void 0,showMedia:void 0,revealBehindCW:void 0}),Object(o.a)(this,"handleToggleHidden",(()=>{const{status:t}=this.props;this.props.settings.getIn(["content_warnings","shared_state"])?t.get("hidden")?this.props.dispatch(Object(F.q)(t.get("id"))):this.props.dispatch(Object(F.o)(t.get("id"))):this.props.status.get("spoiler_text")&&this.setExpansion(!this.state.isExpanded)})),Object(o.a)(this,"handleToggleMediaVisibility",(()=>{this.setState({showMedia:!this.state.showMedia})})),Object(o.a)(this,"handleModalFavourite",(t=>{this.props.dispatch(Object(D.J)(t))})),Object(o.a)(this,"handleFavouriteClick",((t,e)=>{const{dispatch:s}=this.props,{signedIn:a}=this.props.identity;a?t.get("favourited")?s(Object(D.Q)(t)):e&&e.shiftKey||!K.m?this.handleModalFavourite(t):s(Object(B.b)({modalType:"FAVOURITE",modalProps:{status:t,onFavourite:this.handleModalFavourite}})):s(Object(B.b)({modalType:"INTERACTION",modalProps:{type:"favourite",accountId:t.getIn(["account","id"]),url:t.get("uri")}}))})),Object(o.a)(this,"handleReactionAdd",((t,e,s)=>{const{dispatch:a,identity:i}=this.props,{signedIn:o}=i;o&&a(Object(D.F)(t,e,s))})),Object(o.a)(this,"handleReactionRemove",((t,e)=>{this.props.dispatch(Object(D.O)(t,e))})),Object(o.a)(this,"handlePin",(t=>{t.get("pinned")?this.props.dispatch(Object(D.R)(t)):this.props.dispatch(Object(D.M)(t))})),Object(o.a)(this,"handleReplyClick",(t=>{const{askReplyConfirmation:e,dispatch:s,intl:a}=this.props,{signedIn:i}=this.props.identity;s(i?e?Object(B.b)({modalType:"CONFIRM",modalProps:{message:a.formatMessage(zt.replyMessage),confirm:a.formatMessage(zt.replyConfirm),onDoNotAsk:()=>s(Object(S.c)(["confirm_before_clearing_draft"],!1)),onConfirm:()=>s(Object(P.Cb)(t,this.props.history))}}):Object(P.Cb)(t,this.props.history):Object(B.b)({modalType:"INTERACTION",modalProps:{type:"reply",accountId:t.getIn(["account","id"]),url:t.get("uri")}}))})),Object(o.a)(this,"handleModalReblog",((t,e)=>{const{dispatch:s}=this.props;t.get("reblogged")?s(Object(D.S)({statusId:t.get("id")})):s(Object(D.N)({statusId:t.get("id"),visibility:e}))})),Object(o.a)(this,"handleReblogClick",((t,e)=>{const{settings:s,dispatch:a}=this.props,{signedIn:i}=this.props.identity;i?s.get("confirm_boost_missing_media_description")&&t.get("media_attachments").some((t=>!t.get("description")))&&!t.get("reblogged")?a(Object(B.b)({modalType:"BOOST",modalProps:{status:t,onReblog:this.handleModalReblog,missingMediaDescription:!0}})):e&&e.shiftKey||!K.b?this.handleModalReblog(t):a(Object(B.b)({modalType:"BOOST",modalProps:{status:t,onReblog:this.handleModalReblog}})):a(Object(B.b)({modalType:"INTERACTION",modalProps:{type:"reblog",accountId:t.getIn(["account","id"]),url:t.get("uri")}}))})),Object(o.a)(this,"handleBookmarkClick",(t=>{t.get("bookmarked")?this.props.dispatch(Object(D.P)(t)):this.props.dispatch(Object(D.G)(t))})),Object(o.a)(this,"handleDeleteClick",(function(e,s){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{dispatch:i,intl:o}=t.props;K.f?i(Object(B.b)({modalType:"CONFIRM",modalProps:{message:o.formatMessage(a?zt.redraftMessage:zt.deleteMessage),confirm:o.formatMessage(a?zt.redraftConfirm:zt.deleteConfirm),onConfirm:()=>i(Object(F.l)(e.get("id"),s,a))}})):i(Object(F.l)(e.get("id"),s,a))})),Object(o.a)(this,"handleEditClick",((t,e)=>{this.props.dispatch(Object(F.m)(t.get("id"),e))})),Object(o.a)(this,"handleDirectClick",((t,e)=>{this.props.dispatch(Object(P.pb)(t,e))})),Object(o.a)(this,"handleMentionClick",((t,e)=>{this.props.dispatch(Object(P.xb)(t,e))})),Object(o.a)(this,"handleOpenMedia",((t,e,s)=>{this.props.dispatch(Object(B.b)({modalType:"MEDIA",modalProps:{statusId:this.props.status.get("id"),media:t,index:e,lang:s}}))})),Object(o.a)(this,"handleOpenVideo",((t,e,s)=>{this.props.dispatch(Object(B.b)({modalType:"VIDEO",modalProps:{statusId:this.props.status.get("id"),media:t,lang:e,options:s}}))})),Object(o.a)(this,"handleHotkeyOpenMedia",(t=>{const{status:e}=this.props;t.preventDefault(),e.get("media_attachments").size>0&&("video"===e.getIn(["media_attachments",0,"type"])?this.handleOpenVideo(e.getIn(["media_attachments",0]),{startTime:0}):this.handleOpenMedia(e.get("media_attachments"),0))})),Object(o.a)(this,"handleMuteClick",(t=>{this.props.dispatch(Object(A.i)(t))})),Object(o.a)(this,"handleConversationMuteClick",(t=>{t.get("muted")?this.props.dispatch(Object(F.t)(t.get("id"))):this.props.dispatch(Object(F.p)(t.get("id")))})),Object(o.a)(this,"handleToggleAll",(()=>{const{status:t,ancestorsIds:e,descendantsIds:s,settings:a}=this.props,i=[t.get("id")].concat(e.toJS(),s.toJS());let{isExpanded:o}=this.state;a.getIn(["content_warnings","shared_state"])&&(o=!t.get("hidden")),o?this.props.dispatch(Object(F.o)(i)):this.props.dispatch(Object(F.q)(i)),this.setState({isExpanded:!o,threadExpanded:!o})})),Object(o.a)(this,"handleTranslate",(t=>{const{dispatch:e}=this.props;t.get("translation")?e(Object(F.s)(t.get("id"),t.get("poll"))):e(Object(F.r)(t.get("id")))})),Object(o.a)(this,"handleBlockClick",(t=>{const{dispatch:e}=this.props,s=t.get("account");e(Object(E.i)(s))})),Object(o.a)(this,"handleReport",(t=>{this.props.dispatch(Object(V.a)(t.get("account"),t))})),Object(o.a)(this,"handleEmbed",(t=>{this.props.dispatch(Object(B.b)({modalType:"EMBED",modalProps:{id:t.get("id")}}))})),Object(o.a)(this,"handleHotkeyToggleSensitive",(()=>{this.handleToggleMediaVisibility()})),Object(o.a)(this,"handleHotkeyMoveUp",(()=>{this.handleMoveUp(this.props.status.get("id"))})),Object(o.a)(this,"handleHotkeyMoveDown",(()=>{this.handleMoveDown(this.props.status.get("id"))})),Object(o.a)(this,"handleHotkeyReply",(t=>{t.preventDefault(),this.handleReplyClick(this.props.status)})),Object(o.a)(this,"handleHotkeyFavourite",(()=>{this.handleFavouriteClick(this.props.status)})),Object(o.a)(this,"handleHotkeyBoost",(()=>{this.handleReblogClick(this.props.status)})),Object(o.a)(this,"handleHotkeyBookmark",(()=>{this.handleBookmarkClick(this.props.status)})),Object(o.a)(this,"handleHotkeyMention",(t=>{t.preventDefault(),this.handleMentionClick(this.props.status)})),Object(o.a)(this,"handleHotkeyOpenProfile",(()=>{this.props.history.push("/@".concat(this.props.status.getIn(["account","acct"])))})),Object(o.a)(this,"handleMoveUp",(t=>{const{status:e,ancestorsIds:s,descendantsIds:a}=this.props;if(t===e.get("id"))this._selectChild(s.size-1,!0);else{let e=s.indexOf(t);-1===e?(e=a.indexOf(t),this._selectChild(s.size+e,!0)):this._selectChild(e-1,!0)}})),Object(o.a)(this,"handleMoveDown",(t=>{const{status:e,ancestorsIds:s,descendantsIds:a}=this.props;if(t===e.get("id"))this._selectChild(s.size+1,!1);else{let e=s.indexOf(t);-1===e?(e=a.indexOf(t),this._selectChild(s.size+e+2,!1)):this._selectChild(e+1,!1)}})),Object(o.a)(this,"handleHeaderClick",(()=>{this.column.scrollTop()})),Object(o.a)(this,"setExpansion",(t=>{this.setState({isExpanded:t})})),Object(o.a)(this,"setContainerRef",(t=>{this.node=t})),Object(o.a)(this,"setColumnRef",(t=>{this.column=t})),Object(o.a)(this,"setStatusRef",(t=>{this.statusNode=t})),Object(o.a)(this,"onFullScreenChange",(()=>{this.setState({fullscreen:Object(Z.d)()})})),Object(o.a)(this,"shouldUpdateScroll",((t,e)=>{var s,a;let{location:i}=e;return(null===(s=i.state)||void 0===s?void 0:s.mastodonModalKey)===(null==t||null===(a=t.location)||void 0===a||null===(a=a.state)||void 0===a?void 0:a.mastodonModalKey)&&(!!this.statusNode&&[0,this.statusNode.offsetTop])}))}componentDidMount(){Object(Z.a)(this.onFullScreenChange),this.props.dispatch(Object(F.n)(this.props.params.statusId)),this._scrollStatusIntoView()}static getDerivedStateFromProps(t,e){let s={},a=!1;t.params.statusId&&e.statusId!==t.params.statusId&&(t.dispatch(Object(F.n)(t.params.statusId)),s.threadExpanded=void 0,s.statusId=t.params.statusId,a=!0);const i=t.settings.getIn(["media","reveal_behind_cw"]);return i!==e.revealBehindCW&&(s.revealBehindCW=i,i&&(s.showMedia=Object(q.b)(t.status,t.settings)),a=!0),t.status&&e.loadedStatusId!==t.status.get("id")&&(s.showMedia=Object(q.b)(t.status,t.settings),s.loadedStatusId=t.status.get("id"),s.isExpanded=Object(H.b)(t.settings,t.status),a=!0),a?s:null}_selectChild(t,e){const s=this.node,a=s.querySelectorAll(".focusable")[t];a&&(e&&s.scrollTop>a.offsetTop?a.scrollIntoView(!0):!e&&s.scrollTop+s.clientHeight<a.offsetTop+a.offsetHeight&&a.scrollIntoView(!1),a.focus())}renderChildren(t,e){const{params:{statusId:s}}=this.props;return t.map(((a,o)=>Object(i.a)(z.a,{id:a,expanded:this.state.threadExpanded,onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,contextType:"thread",previousId:o>0?t.get(o-1):void 0,nextId:t.get(o+1)||e&&s,rootId:s},a)))}_scrollStatusIntoView(){const{status:t,multiColumn:e}=this.props;t&&requestIdleCallback((()=>{var t;if(null===(t=this.statusNode)||void 0===t||t.scrollIntoView(!0),!e){var s;const t=null===(s=document.querySelector(".column-header__wrapper"))||void 0===s||null===(s=s.getBoundingClientRect())||void 0===s?void 0:s.bottom;if(t){(document.scrollingElement||document.body).scrollBy(0,-t)}}}))}componentDidUpdate(t){var e;const{status:s,ancestorsIds:a}=this.props;s&&(a.size>t.ancestorsIds.size||(null===(e=t.status)||void 0===e?void 0:e.get("id"))!==s.get("id"))&&this._scrollStatusIntoView()}componentWillUnmount(){Object(Z.b)(this.onFullScreenChange)}render(){let t,e;const{isLoading:s,status:a,settings:o,ancestorsIds:n,descendantsIds:d,intl:l,domain:c,multiColumn:r,pictureInPicture:p}=this.props,{fullscreen:g}=this.state;if(s)return Object(i.a)(W.a,{},void 0,Object(i.a)(R.a,{}));if(null===a)return Object(i.a)(x.a,{multiColumn:r,errorType:"routing"});const b=o.getIn(["content_warnings","shared_state"])?!a.get("hidden"):this.state.isExpanded;n&&n.size>0&&(t=Object(Ft.jsx)(Ft.Fragment,{children:this.renderChildren(n,!0)})),d&&d.size>0&&(e=Object(Ft.jsx)(Ft.Fragment,{children:this.renderChildren(d)}));const m=-1===a.getIn(["account","acct"],"").indexOf("@"),O=!a.getIn(["account","noindex"]),f={moveUp:this.handleHotkeyMoveUp,moveDown:this.handleHotkeyMoveDown,reply:this.handleHotkeyReply,favourite:this.handleHotkeyFavourite,boost:this.handleHotkeyBoost,bookmark:this.handleHotkeyBookmark,mention:this.handleHotkeyMention,openProfile:this.handleHotkeyOpenProfile,toggleHidden:this.handleToggleHidden,toggleSensitive:this.handleHotkeyToggleSensitive,openMedia:this.handleHotkeyOpenMedia};return Object(Ft.jsxs)(W.a,{bindToDocument:!r,ref:this.setColumnRef,label:l.formatMessage(zt.detailedStatus),children:[Object(i.a)(U.b,{icon:"comment",iconComponent:y,title:l.formatMessage(zt.tootHeading),onClick:this.handleHeaderClick,showBackButton:!0,multiColumn:r,extraButton:Object(i.a)("button",{type:"button",className:"column-header__button",title:l.formatMessage(b?zt.hideAll:zt.revealAll),"aria-label":l.formatMessage(b?zt.hideAll:zt.revealAll),onClick:this.handleToggleAll},void 0,Object(i.a)(I.a,{id:b?"eye":"eye-slash",icon:b?C.a:k.a}))}),Object(i.a)(w.a,{scrollKey:"thread",shouldUpdateScroll:this.shouldUpdateScroll},void 0,Object(Ft.jsxs)("div",{className:h()("scrollable",{fullscreen:g}),ref:this.setContainerRef,children:[t,Object(i.a)(j.HotKeys,{handlers:f},void 0,Object(Ft.jsxs)("div",{className:h()("focusable","detailed-status__wrapper","detailed-status__wrapper-".concat(a.get("visibility"))),tabIndex:0,"aria-label":Object(q.c)(l,a,!1,b),ref:this.setStatusRef,children:[Object(i.a)(qt,{status:a,settings:o,onOpenVideo:this.handleOpenVideo,onOpenMedia:this.handleOpenMedia,onReactionAdd:this.handleReactionAdd,onReactionRemove:this.handleReactionRemove,expanded:b,onToggleHidden:this.handleToggleHidden,onTranslate:this.handleTranslate,domain:c,showMedia:this.state.showMedia,onToggleMediaVisibility:this.handleToggleMediaVisibility,pictureInPicture:p},"details-".concat(a.get("id"))),Object(i.a)(gt,{status:a,onReply:this.handleReplyClick,onFavourite:this.handleFavouriteClick,onReactionAdd:this.handleReactionAdd,onReblog:this.handleReblogClick,onBookmark:this.handleBookmarkClick,onDelete:this.handleDeleteClick,onEdit:this.handleEditClick,onDirect:this.handleDirectClick,onMention:this.handleMentionClick,onMute:this.handleMuteClick,onMuteConversation:this.handleConversationMuteClick,onBlock:this.handleBlockClick,onReport:this.handleReport,onPin:this.handlePin,onEmbed:this.handleEmbed},"action-bar-".concat(a.get("id")))]})),e]})),Object(i.a)(u.a,{},void 0,Object(i.a)("title",{},void 0,Kt(l,a)),Object(i.a)("meta",{name:"robots",content:m&&O?"all":"noindex"}),Object(i.a)("link",{rel:"canonical",href:a.get("url")}))]})}}Object(o.a)(Lt,"propTypes",{identity:T.c,params:d.a.object.isRequired,dispatch:d.a.func.isRequired,status:O.a.map,isLoading:d.a.bool,settings:O.a.map.isRequired,ancestorsIds:O.a.list.isRequired,descendantsIds:O.a.list.isRequired,intl:d.a.object.isRequired,askReplyConfirmation:d.a.bool,multiColumn:d.a.bool,domain:d.a.string.isRequired,pictureInPicture:O.a.contains({inUse:d.a.bool,available:d.a.bool}),...N.b});e.default=Object(p.k)(Object(c.c)(Object(v.connect)((()=>{const t=Object(L.i)(),e=Object(L.g)(),s=Object(g.a)([(t,e)=>{let{id:s}=e;return s},t=>t.getIn(["contexts","inReplyTos"])],((t,e)=>{let s=b.default.List();return s=s.withMutations((s=>{let a=t;for(;a&&!s.includes(a);)s.unshift(a),a=e.get(a)})),s})),a=Object(g.a)([(t,e)=>{let{id:s}=e;return s},t=>t.getIn(["contexts","replies"]),t=>t.get("statuses")],((t,e,s)=>{let a=[];const i=[t];for(;i.length>0;){let s=i.pop();const o=e.get(s);t!==s&&a.push(s),o&&o.reverse().forEach((e=>{i.includes(e)||a.includes(e)||t===e||i.push(e)}))}let o=a.findIndex((t=>s.get(t).get("in_reply_to_account_id")!==s.get(t).get("account")));return-1!==o&&a.forEach(((t,e)=>{e>o&&s.get(t).get("in_reply_to_account_id")===s.get(t).get("account")&&(a.splice(e,1),a.splice(o,0,t),o+=1)})),b.default.List(a)}));return(i,o)=>{const n=t(i,{id:o.params.statusId});let d=b.default.List(),l=b.default.List();return n&&(d=s(i,{id:n.get("in_reply_to_id")}),l=a(i,{id:n.get("id")})),{isLoading:i.getIn(["statuses",o.params.statusId,"isLoading"]),status:n,ancestorsIds:d,descendantsIds:l,settings:i.get("local_settings"),askReplyConfirmation:i.getIn(["local_settings","confirm_before_clearing_draft"])&&0!==i.getIn(["compose","text"]).trim().length,domain:i.getIn(["meta","domain"]),pictureInPicture:e(i,{id:o.params.statusId})}}}))(Object(T.e)(Lt))))}}]);
//# sourceMappingURL=status.js.map