(window.webpackJsonp=window.webpackJsonp||[]).push([[503],{1973:function(e,t,a){"use strict";a.r(t);var o=a(0),s=a(1),n=a(8),c=a(71),i=a(26),r=a(247),l=a(10),d=a(1164),u=a(537),b=a(330),m=a(1739),g=a(85),j=a(1291),p=a(1289),O=a(2066),v=a(101),f=a.n(v),_=a(1865),h=(a(45),a(14),a(9)),y=a.n(h),M=a(46),C=a(198),k=a(190),x=a(194),w=a(257),I=a(22),N=a(49),S=a(148),D=a(523),T=a(2),P=a(12),K=a(167);class L extends s.PureComponent{renderItem(e,t,a){const{animate:s}=this.props;let n=50,c=100,i="auto",r="auto",l="auto",d="auto";1===t&&(n=100),(4===t||3===t&&a>0)&&(c=50),2===t?0===a?d="1px":r="1px":3===t?(0===a?d="1px":a>0&&(r="1px"),1===a?l="1px":a>1&&(i="1px")):4===t&&(0!==a&&2!==a||(d="1px"),1!==a&&3!==a||(r="1px"),a<2?l="1px":i="1px");const u={left:r,top:i,right:d,bottom:l,width:"".concat(n,"%"),height:"".concat(c,"%")};return Object(o.a)("div",{style:u},e.get("id"),Object(o.a)(K.a,{account:e,animate:s}))}render(){const{accounts:e,size:t}=this.props;return Object(o.a)("div",{className:"account__avatar-composite",style:{width:"".concat(t,"px"),height:"".concat(t,"px")}},void 0,e.take(4).map(((t,a)=>this.renderItem(t,Math.min(e.size,4),a))),e.size>4&&Object(o.a)("span",{className:"account__avatar-composite__label"},void 0,"+",e.size-4))}}Object(T.a)(L,"defaultProps",{animate:P.a});var R=a(51),A=a(173),z=a(234),q=a(413),E=a(482),H=a(231);const U=Object(n.d)({more:{id:"status.more",defaultMessage:"More"},open:{id:"conversation.open",defaultMessage:"View conversation"},reply:{id:"status.reply",defaultMessage:"Reply"},markAsRead:{id:"conversation.mark_as_read",defaultMessage:"Mark as read"},delete:{id:"conversation.delete",defaultMessage:"Delete conversation"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"},replyConfirm:{id:"confirmations.reply.confirm",defaultMessage:"Reply"},replyMessage:{id:"confirmations.reply.message",defaultMessage:"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?"}}),V=Object(C.a)((e=>e.get("accounts")),((e,t)=>t),((e,t)=>t.map((t=>e.get(t))))),W=Object(H.i)(),F=e=>{let{conversation:t,scrollKey:a,onMoveUp:n,onMoveDown:r}=e;const d=t.get("id"),u=t.get("unread"),m=t.get("last_status"),g=t.get("accounts"),j=Object(c.a)(),p=Object(l.useDispatch)(),O=Object(M.g)(),v=Object(l.useSelector)((e=>W(e,{id:m}))),f=Object(l.useSelector)((e=>V(e,g))),_=Object(l.useSelector)((e=>e.getIn(["state","content_warnings","shared_state"]))),[h,C]=Object(s.useState)(void 0),T=Object(s.useCallback)(((e,t)=>{0!==e.button||e.ctrlKey||e.altKey||e.metaKey||(void 0===t&&(u&&p(Object(b.k)(d)),t="/statuses/".concat(v.get("id"))),O.push(t),e.preventDefault())}),[p,O,u,d,v]),K=Object(s.useCallback)((e=>{let{currentTarget:t}=e;if(P.a)return;const a=t.querySelectorAll(".custom-emoji");for(var o=0;o<a.length;o++){let e=a[o];e.src=e.getAttribute("data-original")}}),[]),H=Object(s.useCallback)((e=>{let{currentTarget:t}=e;if(P.a)return;const a=t.querySelectorAll(".custom-emoji");for(var o=0;o<a.length;o++){let e=a[o];e.src=e.getAttribute("data-static")}}),[]),F=Object(s.useCallback)((()=>{u&&p(Object(b.k)(d)),O.push("/@".concat(v.getIn(["account","acct"]),"/").concat(v.get("id")))}),[p,O,u,d,v]),J=Object(s.useCallback)((()=>{p(Object(b.k)(d))}),[p,d]),Y=Object(s.useCallback)((()=>{p(((e,t)=>{0!==t().getIn(["compose","text"]).trim().length?p(Object(N.b)({modalType:"CONFIRM",modalProps:{message:j.formatMessage(U.replyMessage),confirm:j.formatMessage(U.replyConfirm),onConfirm:()=>p(Object(I.Cb)(v,O))}})):p(Object(I.Cb)(v,O))}))}),[p,v,O,j]),G=Object(s.useCallback)((()=>{p(Object(b.i)(d))}),[p,d]),B=Object(s.useCallback)((()=>{n(d)}),[d,n]),Q=Object(s.useCallback)((()=>{r(d)}),[d,r]),X=Object(s.useCallback)((()=>{v.get("muted")?p(Object(S.t)(v.get("id"))):p(Object(S.p)(v.get("id")))}),[p,v]),Z=Object(s.useCallback)((()=>{v.get("hidden")?p(Object(S.q)(v.get("id"))):p(Object(S.o)(v.get("id"))),v.get("spoiler_text")&&C(!h)}),[p,v,h]);if(!v)return null;const $=[{text:j.formatMessage(U.open),action:F},null,{text:j.formatMessage(v.get("muted")?U.unmuteConversation:U.muteConversation),action:X}];u&&($.push({text:j.formatMessage(U.markAsRead),action:J}),$.push(null)),$.push({text:j.formatMessage(U.delete),action:G});const ee=f.map((e=>Object(o.a)(A.a,{to:"/@".concat(e.get("acct")),href:e.get("url"),"data-hover-card-account":e.get("id")},e.get("id"),Object(o.a)("bdi",{},void 0,Object(o.a)("strong",{className:"display-name__html",dangerouslySetInnerHTML:{__html:e.get("display_name_html")}}))))).reduce(((e,t)=>[e,", ",t])),te={reply:Y,open:F,moveUp:B,moveDown:Q,toggleHidden:Z};let ae=null;return v.get("media_attachments").size>0&&(ae=Object(o.a)(D.a,{compact:!0,media:v.get("media_attachments")})),Object(o.a)(k.HotKeys,{handlers:te},void 0,Object(o.a)("div",{className:y()("conversation focusable muted",{"conversation--unread":u}),tabIndex:0},void 0,Object(o.a)("div",{className:"conversation__avatar",onClick:F,role:"presentation"},void 0,Object(o.a)(L,{accounts:f,size:48})),Object(o.a)("div",{className:"conversation__content"},void 0,Object(o.a)("div",{className:"conversation__content__info"},void 0,Object(o.a)("div",{className:"conversation__content__relative-time"},void 0,u&&Object(o.a)("span",{className:"conversation__unread"})," ",Object(o.a)(z.a,{timestamp:v.get("created_at")})),Object(o.a)("div",{className:"conversation__content__names",onMouseEnter:K,onMouseLeave:H},void 0,Object(o.a)(i.a,{id:"conversation.with",defaultMessage:"With {names}",values:{names:Object(o.a)("span",{},void 0,ee)}}))),Object(o.a)(q.a,{status:v,parseClick:T,expanded:_?v.get("hidden"):h,onExpandedToggle:Z,collapsible:!0,media:ae}),Object(o.a)("div",{className:"status__action-bar"},void 0,Object(o.a)(R.a,{className:"status__action-bar-button",title:j.formatMessage(U.reply),icon:"reply",iconComponent:w.a,onClick:Y}),Object(o.a)("div",{className:"status__action-bar-dropdown"},void 0,Object(o.a)(E.a,{scrollKey:a,status:v,items:$,icon:"ellipsis-h",iconComponent:x.a,size:18,direction:"right",title:j.formatMessage(U.more)}))))))};var J=a(6);const Y=(e,t,a)=>{const o=e.querySelector("article:nth-of-type(".concat(t+1,") .focusable"));o&&(a&&e.scrollTop>o.offsetTop?o.scrollIntoView(!0):!a&&e.scrollTop+e.clientHeight<o.offsetTop+o.offsetHeight&&o.scrollIntoView(!1),o.focus())},G=e=>{var t;let{scrollKey:a,...n}=e;const c=Object(s.useRef)(),i=Object(l.useSelector)((e=>e.getIn(["conversations","items"]))),r=Object(l.useSelector)((e=>e.getIn(["conversations","isLoading"],!0))),d=Object(l.useSelector)((e=>e.getIn(["conversations","hasMore"],!1))),u=Object(l.useDispatch)(),m=null===(t=i.last())||void 0===t?void 0:t.get("last_status"),g=Object(s.useCallback)((e=>{const t=i.findIndex((t=>t.get("id")===e))-1;Y(c.current.node,t,!0)}),[c,i]),j=Object(s.useCallback)((e=>{const t=i.findIndex((t=>t.get("id")===e))+1;Y(c.current.node,t,!1)}),[c,i]),p=Object(s.useMemo)((()=>f()((e=>{u(Object(b.j)({maxId:e}))}),300,{leading:!0})),[u]),O=Object(s.useCallback)((()=>{m&&p(m)}),[p,m]);return Object(J.jsx)(_.a,{...n,scrollKey:a,isLoading:r,showLoading:r&&i.isEmpty(),hasMore:d,onLoadMore:O,ref:c,children:i.map((e=>Object(o.a)(F,{conversation:e,onMoveUp:g,onMoveDown:j,scrollKey:a},e.get("id"))))})};var B=a(166),Q=a(54),X=a(2070),Z=a(2076);const $=Object(n.d)({filter_regex:{id:"home.column_settings.filter_regex",defaultMessage:"Filter out by regular expressions"},settings:{id:"home.settings",defaultMessage:"Column settings"}});class ee extends s.PureComponent{render(){const{settings:e,onChange:t,intl:a}=this.props;return Object(o.a)("div",{className:"column-settings"},void 0,Object(o.a)("section",{},void 0,Object(o.a)("div",{className:"column-settings__row"},void 0,Object(o.a)(X.a,{settings:e,settingPath:["conversations"],onChange:t,label:Object(o.a)(i.a,{id:"direct.group_by_conversations",defaultMessage:"Group by conversation"})}))),Object(o.a)("section",{},void 0,Object(o.a)("h3",{},void 0,Object(o.a)(i.a,{id:"home.column_settings.advanced",defaultMessage:"Advanced"})),Object(o.a)("div",{className:"column-settings__row"},void 0,Object(o.a)(Z.a,{settings:e,settingPath:["regex","body"],onChange:t,label:a.formatMessage($.filter_regex)}))))}}var te=Object(Q.c)(ee);var ae=Object(l.connect)((e=>({settings:e.getIn(["settings","direct"])})),(e=>({onChange(t,a){e(Object(B.c)(["direct",...t],a))}})))(te);const oe=Object(n.d)({title:{id:"column.direct",defaultMessage:"Private mentions"}});t.default=e=>{let{columnId:t,multiColumn:a}=e;const n=Object(s.useRef)(),v=Object(c.a)(),f=Object(l.useDispatch)(),_=!!t,h=Object(l.useSelector)((e=>e.getIn(["timelines","direct","unread"])>0)),y=Object(l.useSelector)((e=>e.getIn(["settings","direct","conversations"]))),M=Object(s.useCallback)((()=>{f(t?Object(u.h)(t):Object(u.e)("DIRECT",{}))}),[f,t]),C=Object(s.useCallback)((e=>{f(Object(u.g)(t,e))}),[f,t]),k=Object(s.useCallback)((()=>{n.current.scrollTop()}),[n]),x=Object(s.useCallback)((e=>{f(Object(g.u)({maxId:e}))}),[f]);return Object(s.useEffect)((()=>{f(Object(b.l)()),f(y?Object(b.j)():Object(g.u)());const e=f(Object(m.b)());return()=>{f(Object(b.m)()),e()}}),[f,y]),Object(J.jsxs)(j.a,{bindToDocument:!a,ref:n,label:v.formatMessage(oe.title),children:[Object(o.a)(p.b,{icon:"envelope",iconComponent:d.a,active:h,title:v.formatMessage(oe.title),onPin:M,onMove:C,onClick:k,pinned:_,multiColumn:a},void 0,Object(o.a)(ae,{})),y?Object(o.a)(G,{trackScroll:!_,scrollKey:"direct_timeline-".concat(t),emptyMessage:Object(o.a)(i.a,{id:"empty_column.direct",defaultMessage:"You don't have any private mentions yet. When you send or receive one, it will show up here."}),bindToDocument:!a,prepend:Object(o.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(o.a)("span",{},void 0,Object(o.a)(i.a,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(o.a)("a",{href:"/terms",target:"_blank"},void 0,Object(o.a)(i.a,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),alwaysPrepend:!0}):Object(o.a)(O.a,{trackScroll:!_,scrollKey:"direct_timeline-".concat(t),timelineId:"direct",bindToDocument:!a,onLoadMore:x,prepend:Object(o.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(o.a)("span",{},void 0,Object(o.a)(i.a,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(o.a)("a",{href:"/terms",target:"_blank"},void 0,Object(o.a)(i.a,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),alwaysPrepend:!0,emptyMessage:Object(o.a)(i.a,{id:"empty_column.direct",defaultMessage:"You don't have any private mentions yet. When you send or receive one, it will show up here."})}),Object(o.a)(r.a,{},void 0,Object(o.a)("title",{},void 0,v.formatMessage(oe.title)),Object(o.a)("meta",{name:"robots",content:"noindex"}))]})}}}]);
//# sourceMappingURL=direct_timeline.js.map