(window.webpackJsonp=window.webpackJsonp||[]).push([[503],{2013:function(e,t,a){"use strict";a.r(t);var o=a(0),s=a(1),n=a(8),c=a(72),i=a(26),r=a(201),l=a(10),d=a(1185),u=a(329),b=a(345),m=a(1775),g=a(88),j=a(557),O=a(555),v=a(2106),p=a(96),_=a.n(p),f=a(1512),h=(a(41),a(13),a(9)),M=a.n(h),y=a(47),C=a(173),k=a(152),x=a(203),w=a(266),I=a(22),N=a(51),D=a(130),S=a(543),T=a(2),P=a(12),K=a(161);class L extends s.PureComponent{renderItem(e,t,a){const{animate:s}=this.props;let n=50,c=100,i="auto",r="auto",l="auto",d="auto";1===t&&(n=100),(4===t||3===t&&a>0)&&(c=50),2===t?0===a?d="1px":r="1px":3===t?(0===a?d="1px":a>0&&(r="1px"),1===a?l="1px":a>1&&(i="1px")):4===t&&(0!==a&&2!==a||(d="1px"),1!==a&&3!==a||(r="1px"),a<2?l="1px":i="1px");const u={left:r,top:i,right:d,bottom:l,width:"".concat(n,"%"),height:"".concat(c,"%")};return Object(o.a)("div",{style:u},e.get("id"),Object(o.a)(K.a,{account:e,animate:s}))}render(){const{accounts:e,size:t}=this.props;return Object(o.a)("div",{className:"account__avatar-composite",style:{width:"".concat(t,"px"),height:"".concat(t,"px")}},void 0,e.take(4).map(((t,a)=>this.renderItem(t,Math.min(e.size,4),a))),e.size>4&&Object(o.a)("span",{className:"account__avatar-composite__label"},void 0,"+",e.size-4))}}Object(T.a)(L,"defaultProps",{animate:P.a});var R=a(53),z=a(182),A=a(208),E=a(440),q=a(496),H=a(240);const U=Object(n.d)({more:{id:"status.more",defaultMessage:"More"},open:{id:"conversation.open",defaultMessage:"View conversation"},reply:{id:"status.reply",defaultMessage:"Reply"},markAsRead:{id:"conversation.mark_as_read",defaultMessage:"Mark as read"},delete:{id:"conversation.delete",defaultMessage:"Delete conversation"},muteConversation:{id:"status.mute_conversation",defaultMessage:"Mute conversation"},unmuteConversation:{id:"status.unmute_conversation",defaultMessage:"Unmute conversation"}}),V=Object(C.a)((e=>e.get("accounts")),((e,t)=>t),((e,t)=>t.map((t=>e.get(t))))),W=Object(H.i)(),Y=e=>{let{conversation:t,scrollKey:a,onMoveUp:n,onMoveDown:r}=e;const d=t.get("id"),u=t.get("unread"),m=t.get("last_status"),g=t.get("accounts"),j=Object(c.a)(),O=Object(l.useDispatch)(),v=Object(y.g)(),p=Object(l.useSelector)((e=>W(e,{id:m}))),_=Object(l.useSelector)((e=>V(e,g))),f=Object(l.useSelector)((e=>e.getIn(["state","content_warnings","shared_state"]))),[h,C]=Object(s.useState)(void 0),T=Object(s.useCallback)(((e,t)=>{0!==e.button||e.ctrlKey||e.altKey||e.metaKey||(void 0===t&&(u&&O(Object(b.k)(d)),t="/statuses/".concat(p.get("id"))),v.push(t),e.preventDefault())}),[O,v,u,d,p]),K=Object(s.useCallback)((e=>{let{currentTarget:t}=e;if(P.a)return;const a=t.querySelectorAll(".custom-emoji");for(var o=0;o<a.length;o++){let e=a[o];e.src=e.getAttribute("data-original")}}),[]),H=Object(s.useCallback)((e=>{let{currentTarget:t}=e;if(P.a)return;const a=t.querySelectorAll(".custom-emoji");for(var o=0;o<a.length;o++){let e=a[o];e.src=e.getAttribute("data-static")}}),[]),Y=Object(s.useCallback)((()=>{u&&O(Object(b.k)(d)),v.push("/@".concat(p.getIn(["account","acct"]),"/").concat(p.get("id")))}),[O,v,u,d,p]),F=Object(s.useCallback)((()=>{O(Object(b.k)(d))}),[O,d]),J=Object(s.useCallback)((()=>{O(((e,t)=>{0!==t().getIn(["compose","text"]).trim().length?O(Object(N.b)({modalType:"CONFIRM_REPLY",modalProps:{status:p}})):O(Object(I.Db)(p))}))}),[O,p]),G=Object(s.useCallback)((()=>{O(Object(b.i)(d))}),[O,d]),B=Object(s.useCallback)((()=>{n(d)}),[d,n]),Q=Object(s.useCallback)((()=>{r(d)}),[d,r]),X=Object(s.useCallback)((()=>{p.get("muted")?O(Object(D.v)(p.get("id"))):O(Object(D.p)(p.get("id")))}),[O,p]),Z=Object(s.useCallback)((()=>{O(Object(D.s)(p.get("id"))),p.get("spoiler_text")&&C(!h)}),[O,p,h]);if(!p)return null;const $=[{text:j.formatMessage(U.open),action:Y},null,{text:j.formatMessage(p.get("muted")?U.unmuteConversation:U.muteConversation),action:X}];u&&($.push({text:j.formatMessage(U.markAsRead),action:F}),$.push(null)),$.push({text:j.formatMessage(U.delete),action:G});const ee=_.map((e=>Object(o.a)(z.a,{to:"/@".concat(e.get("acct")),href:e.get("url"),"data-hover-card-account":e.get("id")},e.get("id"),Object(o.a)("bdi",{},void 0,Object(o.a)("strong",{className:"display-name__html",dangerouslySetInnerHTML:{__html:e.get("display_name_html")}}))))).reduce(((e,t)=>[e,", ",t])),te={reply:J,open:Y,moveUp:B,moveDown:Q,toggleHidden:Z};let ae=null;return p.get("media_attachments").size>0&&(ae=Object(o.a)(S.a,{compact:!0,media:p.get("media_attachments")})),Object(o.a)(k.HotKeys,{handlers:te},void 0,Object(o.a)("div",{className:M()("conversation focusable muted",{"conversation--unread":u}),tabIndex:0},void 0,Object(o.a)("div",{className:"conversation__avatar",onClick:Y,role:"presentation"},void 0,Object(o.a)(L,{accounts:_,size:48})),Object(o.a)("div",{className:"conversation__content"},void 0,Object(o.a)("div",{className:"conversation__content__info"},void 0,Object(o.a)("div",{className:"conversation__content__relative-time"},void 0,u&&Object(o.a)("span",{className:"conversation__unread"})," ",Object(o.a)(A.a,{timestamp:p.get("created_at")})),Object(o.a)("div",{className:"conversation__content__names",onMouseEnter:K,onMouseLeave:H},void 0,Object(o.a)(i.a,{id:"conversation.with",defaultMessage:"With {names}",values:{names:Object(o.a)("span",{},void 0,ee)}}))),Object(o.a)(E.a,{status:p,parseClick:T,expanded:f?p.get("hidden"):h,onExpandedToggle:Z,collapsible:!0,media:ae}),Object(o.a)("div",{className:"status__action-bar"},void 0,Object(o.a)(R.a,{className:"status__action-bar-button",title:j.formatMessage(U.reply),icon:"reply",iconComponent:w.a,onClick:J}),Object(o.a)("div",{className:"status__action-bar-dropdown"},void 0,Object(o.a)(q.a,{scrollKey:a,status:p,items:$,icon:"ellipsis-h",iconComponent:x.a,size:18,direction:"right",title:j.formatMessage(U.more)}))))))};var F=a(6);const J=(e,t,a)=>{const o=e.querySelector("article:nth-of-type(".concat(t+1,") .focusable"));o&&(a&&e.scrollTop>o.offsetTop?o.scrollIntoView(!0):!a&&e.scrollTop+e.clientHeight<o.offsetTop+o.offsetHeight&&o.scrollIntoView(!1),o.focus())},G=e=>{var t;let{scrollKey:a,...n}=e;const c=Object(s.useRef)(),i=Object(l.useSelector)((e=>e.getIn(["conversations","items"]))),r=Object(l.useSelector)((e=>e.getIn(["conversations","isLoading"],!0))),d=Object(l.useSelector)((e=>e.getIn(["conversations","hasMore"],!1))),u=Object(l.useDispatch)(),m=null===(t=i.last())||void 0===t?void 0:t.get("last_status"),g=Object(s.useCallback)((e=>{const t=i.findIndex((t=>t.get("id")===e))-1;J(c.current.node,t,!0)}),[c,i]),j=Object(s.useCallback)((e=>{const t=i.findIndex((t=>t.get("id")===e))+1;J(c.current.node,t,!1)}),[c,i]),O=Object(s.useMemo)((()=>_()((e=>{u(Object(b.j)({maxId:e}))}),300,{leading:!0})),[u]),v=Object(s.useCallback)((()=>{m&&O(m)}),[O,m]);return Object(F.jsx)(f.a,{...n,scrollKey:a,isLoading:r,showLoading:r&&i.isEmpty(),hasMore:d,onLoadMore:v,ref:c,children:i.map((e=>Object(o.a)(Y,{conversation:e,onMoveUp:g,onMoveDown:j,scrollKey:a},e.get("id"))))})};var B=a(137),Q=a(58),X=a(1638),Z=a(2113);const $=Object(n.d)({filter_regex:{id:"home.column_settings.filter_regex",defaultMessage:"Filter out by regular expressions"},settings:{id:"home.settings",defaultMessage:"Column settings"}});class ee extends s.PureComponent{render(){const{settings:e,onChange:t,intl:a}=this.props;return Object(o.a)("div",{className:"column-settings"},void 0,Object(o.a)("section",{},void 0,Object(o.a)("div",{className:"column-settings__row"},void 0,Object(o.a)(X.a,{settings:e,settingPath:["conversations"],onChange:t,label:Object(o.a)(i.a,{id:"direct.group_by_conversations",defaultMessage:"Group by conversation"})}))),Object(o.a)("section",{},void 0,Object(o.a)("h3",{},void 0,Object(o.a)(i.a,{id:"home.column_settings.advanced",defaultMessage:"Advanced"})),Object(o.a)("div",{className:"column-settings__row"},void 0,Object(o.a)(Z.a,{settings:e,settingPath:["regex","body"],onChange:t,label:a.formatMessage($.filter_regex)}))))}}var te=Object(Q.c)(ee);var ae=Object(l.connect)((e=>({settings:e.getIn(["settings","direct"])})),(e=>({onChange(t,a){e(Object(B.c)(["direct",...t],a))}})))(te);const oe=Object(n.d)({title:{id:"column.direct",defaultMessage:"Private mentions"}});t.default=e=>{let{columnId:t,multiColumn:a}=e;const n=Object(s.useRef)(),p=Object(c.a)(),_=Object(l.useDispatch)(),f=!!t,h=Object(l.useSelector)((e=>e.getIn(["timelines","direct","unread"])>0)),M=Object(l.useSelector)((e=>e.getIn(["settings","direct","conversations"]))),y=Object(s.useCallback)((()=>{_(t?Object(u.h)(t):Object(u.e)("DIRECT",{}))}),[_,t]),C=Object(s.useCallback)((e=>{_(Object(u.g)(t,e))}),[_,t]),k=Object(s.useCallback)((()=>{n.current.scrollTop()}),[n]),x=Object(s.useCallback)((e=>{_(Object(g.u)({maxId:e}))}),[_]);return Object(s.useEffect)((()=>{_(Object(b.l)()),_(M?Object(b.j)():Object(g.u)());const e=_(Object(m.b)());return()=>{_(Object(b.m)()),e()}}),[_,M]),Object(F.jsxs)(j.a,{bindToDocument:!a,ref:n,label:p.formatMessage(oe.title),children:[Object(o.a)(O.b,{icon:"envelope",iconComponent:d.a,active:h,title:p.formatMessage(oe.title),onPin:y,onMove:C,onClick:k,pinned:f,multiColumn:a},void 0,Object(o.a)(ae,{})),M?Object(o.a)(G,{trackScroll:!f,scrollKey:"direct_timeline-".concat(t),emptyMessage:Object(o.a)(i.a,{id:"empty_column.direct",defaultMessage:"You don't have any private mentions yet. When you send or receive one, it will show up here."}),bindToDocument:!a,prepend:Object(o.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(o.a)("span",{},void 0,Object(o.a)(i.a,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(o.a)("a",{href:"/terms",target:"_blank"},void 0,Object(o.a)(i.a,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),alwaysPrepend:!0}):Object(o.a)(v.a,{trackScroll:!f,scrollKey:"direct_timeline-".concat(t),timelineId:"direct",bindToDocument:!a,onLoadMore:x,prepend:Object(o.a)("div",{className:"follow_requests-unlocked_explanation"},void 0,Object(o.a)("span",{},void 0,Object(o.a)(i.a,{id:"compose_form.encryption_warning",defaultMessage:"Posts on Mastodon are not end-to-end encrypted. Do not share any dangerous information over Mastodon."})," ",Object(o.a)("a",{href:"/terms",target:"_blank"},void 0,Object(o.a)(i.a,{id:"compose_form.direct_message_warning_learn_more",defaultMessage:"Learn more"})))),alwaysPrepend:!0,emptyMessage:Object(o.a)(i.a,{id:"empty_column.direct",defaultMessage:"You don't have any private mentions yet. When you send or receive one, it will show up here."})}),Object(o.a)(r.a,{},void 0,Object(o.a)("title",{},void 0,p.formatMessage(oe.title)),Object(o.a)("meta",{name:"robots",content:"noindex"}))]})}}}]);
//# sourceMappingURL=direct_timeline.js.map